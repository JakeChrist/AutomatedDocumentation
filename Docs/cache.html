<!-- Generated by DocGen-LM -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>cache</title>
    <link rel="stylesheet" href="static/style.css">
</head>
<body>
    <button id="sidebar-toggle">Menu</button>
    <div class="sidebar">
        <h2>Navigation</h2>
        <ul><li><a href="index.html"><strong>üè† Project Overview</strong></a></li><li><a href="cache.html">cache</a></li><li><a href="chunk_utils.html">chunk_utils</a></li><li><a href="docgenerator.html">docgenerator</a></li><li><a href="explaincode.html">explaincode</a></li><li><a href="gui_wrapper.html">gui_wrapper</a></li><li><a href="html_writer.html">html_writer</a></li><li><a href="llm_client.html">llm_client</a></li><li><a href="manual_utils.html">manual_utils</a></li><li><a href="parser_cpp.html">parser_cpp</a></li><li><a href="parser_java.html">parser_java</a></li><li><a href="parser_matlab.html">parser_matlab</a></li><li><a href="parser_python.html">parser_python</a></li><li><a href="retrofit_sidebar.html">retrofit_sidebar</a></li><li><a href="reviewer.html">reviewer</a></li><li><a href="sanitize_docs.html">sanitize_docs</a></li><li><a href="scanner.html">scanner</a></li><li><a href="setup.html">setup</a></li><li><a href="summarize_utils.html">summarize_utils</a></li><li><details><summary>tests</summary><ul><li><a href="test_cache.html">test_cache</a></li><li><a href="test_chunk_utils.html">test_chunk_utils</a></li><li><a href="test_docgenerator.html">test_docgenerator</a></li><li><a href="test_docgenerator_subclasses.html">test_docgenerator_subclasses</a></li><li><a href="test_explaincode.html">test_explaincode</a></li><li><a href="test_html_writer.html">test_html_writer</a></li><li><a href="test_integration.html">test_integration</a></li><li><a href="test_llm_client.html">test_llm_client</a></li><li><a href="test_manual_utils.html">test_manual_utils</a></li><li><a href="test_parser_cpp.html">test_parser_cpp</a></li><li><a href="test_parser_java.html">test_parser_java</a></li><li><a href="test_parser_matlab.html">test_parser_matlab</a></li><li><a href="test_parser_python.html">test_parser_python</a></li><li><a href="test_resume_progress.html">test_resume_progress</a></li><li><a href="test_reviewer.html">test_reviewer</a></li><li><a href="test_sanitize_docs.html">test_sanitize_docs</a></li><li><a href="test_scanner.html">test_scanner</a></li></ul></details></li></ul>
    </div>
    <div class="content">
        <h1>cache</h1>
        <p>A simple on-disk cache for Language Model (LLM) responses. Implements methods to store and retrieve LLM responses using deterministic keys derived from file paths and content. Includes functionality to manage progress data for processed modules. Cache is persisted to disk in JSON format.</p>
<h2 id="ResponseCache">Class: ResponseCache</h2>
<p>The `ResponseCache` class provides a mechanism for persisting and retrieving mappings from stable keys to language model responses. It uses JSON files to store the data on disk, ensuring that the cache can be reused across sessions. The class includes methods for setting and getting cached values, as well as managing progress information associated with processed module paths.</p>
<h3 id="__init__">Method: __init__(self, path: str) -&gt; None</h3>
<p>Initializes a `ResponseCache` instance with a specified path. Reads an existing JSON file if it exists, parsing its contents into a dictionary. If the file does not exist or is invalid JSON, initializes an empty dictionary. Ensures that a progress map is present in the data dictionary.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>, path: <span style="color: #008000">str</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #008000">self</span><span style="color: #666666">.</span>file <span style="color: #666666">=</span> Path(path)
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>file<span style="color: #666666">.</span>exists():
            <span style="color: #008000; font-weight: bold">try</span>:
                <span style="color: #008000">self</span><span style="color: #666666">.</span>_data: Dict[<span style="color: #008000">str</span>, Any] <span style="color: #666666">=</span> json<span style="color: #666666">.</span>loads(
                    <span style="color: #008000">self</span><span style="color: #666666">.</span>file<span style="color: #666666">.</span>read_text(encoding<span style="color: #666666">=</span><span style="color: #BA2121">&quot;utf-8&quot;</span>)
                )
            <span style="color: #008000; font-weight: bold">except</span> json<span style="color: #666666">.</span>JSONDecodeError:
                <span style="color: #008000">self</span><span style="color: #666666">.</span>_data <span style="color: #666666">=</span> {}
        <span style="color: #008000; font-weight: bold">else</span>:
            <span style="color: #008000">self</span><span style="color: #666666">.</span>_data <span style="color: #666666">=</span> {}
        <span style="color: #3D7B7B; font-style: italic"># ensure progress map exists</span>
        <span style="color: #008000">self</span><span style="color: #666666">.</span>_data<span style="color: #666666">.</span>setdefault(<span style="color: #BA2121">&quot;__progress__&quot;</span>, {})
</code></pre>
<h3 id="make_key">Method: make_key(file_path: str, content: str) -&gt; str</h3>
<p>This function generates a deterministic key for a given file path and content. It uses the SHA-256 hash algorithm to create a unique digest of the content, then combines this digest with the file path to form a key. The key is returned as a string in the format &quot;file_path:digest&quot;.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">make_key</span>(file_path: <span style="color: #008000">str</span>, content: <span style="color: #008000">str</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000">str</span>:
<span style="color: #bbbbbb">        </span><span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Return a deterministic key for *file_path* and *content*.&quot;&quot;&quot;</span>
        digest <span style="color: #666666">=</span> hashlib<span style="color: #666666">.</span>sha256(content<span style="color: #666666">.</span>encode(<span style="color: #BA2121">&quot;utf-8&quot;</span>))<span style="color: #666666">.</span>hexdigest()
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">f&quot;</span><span style="color: #A45A77; font-weight: bold">{</span>file_path<span style="color: #A45A77; font-weight: bold">}</span><span style="color: #BA2121">:</span><span style="color: #A45A77; font-weight: bold">{</span>digest<span style="color: #A45A77; font-weight: bold">}</span><span style="color: #BA2121">&quot;</span>
</code></pre>
<h3 id="get">Method: get(self, key: str) -&gt; Optional[str]</h3>
<p>This function is part of the `ResponseCache` class. It defines a method to retrieve a cached value associated with a given key. The method takes one parameter, `key`, which is a string representing the cache key. If the key exists in the `_data` dictionary of the `ResponseCache` instance, it returns the corresponding cached value; otherwise, it returns `None`.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">get</span>(<span style="color: #008000">self</span>, key: <span style="color: #008000">str</span>) <span style="color: #666666">-&gt;</span> Optional[<span style="color: #008000">str</span>]:
<span style="color: #bbbbbb">        </span><span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Return the cached value for ``key`` if present.&quot;&quot;&quot;</span>
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>_data<span style="color: #666666">.</span>get(key)
</code></pre>
<h3 id="set">Method: set(self, key: str, value: str) -&gt; None</h3>
<p>This function is part of a class `ResponseCache` and is named `set`. It takes two parameters: `key` (a string) and `value` (a string). The function stores the provided `value` under the specified `key` within an internal data structure (`self._data`). After storing the value, it calls another method `_save()` to persist this change to disk.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">set</span>(<span style="color: #008000">self</span>, key: <span style="color: #008000">str</span>, value: <span style="color: #008000">str</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
<span style="color: #bbbbbb">        </span><span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Store ``value`` under ``key`` and persist to disk.&quot;&quot;&quot;</span>
        <span style="color: #008000">self</span><span style="color: #666666">.</span>_data[key] <span style="color: #666666">=</span> value
        <span style="color: #008000">self</span><span style="color: #666666">.</span>_save()
</code></pre>
<h3 id="get_progress">Method: get_progress(self) -&gt; Dict[str, Any]</h3>
<p>This function `get_progress` is part of the `ResponseCache` class. It returns a dictionary representing the progress of processed module paths and their associated data. The function retrieves this information from an internal `_data` attribute, specifically accessing the value associated with the key `&quot;__progress__&quot;`. If no such key exists, it defaults to an empty dictionary. To prevent accidental modification of the returned data, the function returns a shallow copy of the progress dictionary using `dict(progress)`.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">get_progress</span>(<span style="color: #008000">self</span>) <span style="color: #666666">-&gt;</span> Dict[<span style="color: #008000">str</span>, Any]:
<span style="color: #bbbbbb">        </span><span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Return the mapping of processed module paths to their data.&quot;&quot;&quot;</span>
        progress <span style="color: #666666">=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>_data<span style="color: #666666">.</span>get(<span style="color: #BA2121">&quot;__progress__&quot;</span>, {})
        <span style="color: #3D7B7B; font-style: italic"># return a shallow copy to prevent accidental mutation</span>
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">dict</span>(progress)
</code></pre>
<h3 id="set_progress_entry">Method: set_progress_entry(self, path: str, module_data: Dict[str, Any]) -&gt; None</h3>
<p>Records `module_data` for a given `path` in the progress map and saves the updated progress.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">set_progress_entry</span>(<span style="color: #008000">self</span>, path: <span style="color: #008000">str</span>, module_data: Dict[<span style="color: #008000">str</span>, Any]) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
<span style="color: #bbbbbb">        </span><span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Record ``module_data`` for ``path`` in the progress map.&quot;&quot;&quot;</span>
        progress <span style="color: #666666">=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>_data<span style="color: #666666">.</span>setdefault(<span style="color: #BA2121">&quot;__progress__&quot;</span>, {})
        progress[path] <span style="color: #666666">=</span> module_data
        <span style="color: #008000">self</span><span style="color: #666666">.</span>_save()
</code></pre>
<h3 id="clear_progress">Method: clear_progress(self) -&gt; None</h3>
<p>This function, `clear_progress`, is part of the `ResponseCache` class. It removes all saved progress information from the cache by setting the value associated with the key `&quot;__progress__&quot;` to an empty dictionary. After updating the data, it calls the `_save` method to persist the changes.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">clear_progress</span>(<span style="color: #008000">self</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
<span style="color: #bbbbbb">        </span><span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Remove all saved progress information.&quot;&quot;&quot;</span>
        <span style="color: #008000">self</span><span style="color: #666666">.</span>_data[<span style="color: #BA2121">&quot;__progress__&quot;</span>] <span style="color: #666666">=</span> {}
        <span style="color: #008000">self</span><span style="color: #666666">.</span>_save()
</code></pre>
<h3 id="_save">Method: _save(self) -&gt; None</h3>
<p>This function `_save` is a method of the `ResponseCache` class. It saves the data stored in the `_data` attribute to a file using the `file` attribute. The data is serialized to JSON format with an indentation of 2 spaces and sorted keys for better readability. The encoding used for writing the file is UTF-8.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">_save</span>(<span style="color: #008000">self</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #008000">self</span><span style="color: #666666">.</span>file<span style="color: #666666">.</span>write_text(json<span style="color: #666666">.</span>dumps(<span style="color: #008000">self</span><span style="color: #666666">.</span>_data, indent<span style="color: #666666">=2</span>, sort_keys<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">True</span>), encoding<span style="color: #666666">=</span><span style="color: #BA2121">&quot;utf-8&quot;</span>)
</code></pre>
    </div>
    <script src="static/toggle.js"></script>
</body>
</html>
