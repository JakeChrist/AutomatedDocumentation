<!-- Generated by DocGen-LM -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>cache</title>
    <link rel="stylesheet" href="static/style.css">
</head>
<body>
    <button id="sidebar-toggle">Menu</button>
    <div class="sidebar">
        <h2>Navigation</h2>
        <ul><li><a href="index.html"><strong>üè† Project Overview</strong></a></li><li><a href="cache.html">cache</a></li><li><a href="chunk_utils.html">chunk_utils</a></li><li><a href="docgenerator.html">docgenerator</a></li><li><a href="explaincode.html">explaincode</a></li><li><a href="gui_wrapper.html">gui_wrapper</a></li><li><a href="html_writer.html">html_writer</a></li><li><a href="llm_client.html">llm_client</a></li><li><a href="manual_utils.html">manual_utils</a></li><li><a href="parser_cpp.html">parser_cpp</a></li><li><a href="parser_java.html">parser_java</a></li><li><a href="parser_matlab.html">parser_matlab</a></li><li><a href="parser_python.html">parser_python</a></li><li><a href="retrofit_sidebar.html">retrofit_sidebar</a></li><li><a href="reviewer.html">reviewer</a></li><li><a href="sanitize_docs.html">sanitize_docs</a></li><li><a href="scanner.html">scanner</a></li><li><a href="setup.html">setup</a></li><li><a href="summarize_utils.html">summarize_utils</a></li><li><details><summary>tests</summary><ul><li><a href="test_cache.html">test_cache</a></li><li><a href="test_chunk_utils.html">test_chunk_utils</a></li><li><a href="test_docgenerator.html">test_docgenerator</a></li><li><a href="test_docgenerator_subclasses.html">test_docgenerator_subclasses</a></li><li><a href="test_explaincode.html">test_explaincode</a></li><li><a href="test_html_writer.html">test_html_writer</a></li><li><a href="test_integration.html">test_integration</a></li><li><a href="test_llm_client.html">test_llm_client</a></li><li><a href="test_manual_utils.html">test_manual_utils</a></li><li><a href="test_parser_cpp.html">test_parser_cpp</a></li><li><a href="test_parser_java.html">test_parser_java</a></li><li><a href="test_parser_matlab.html">test_parser_matlab</a></li><li><a href="test_parser_python.html">test_parser_python</a></li><li><a href="test_resume_progress.html">test_resume_progress</a></li><li><a href="test_retrofit_sidebar.html">test_retrofit_sidebar</a></li><li><a href="test_reviewer.html">test_reviewer</a></li><li><a href="test_sanitize_docs.html">test_sanitize_docs</a></li><li><a href="test_scanner.html">test_scanner</a></li></ul></details></li></ul>
    </div>
    <div class="content">
        <h1>cache</h1>
        <p>The module implements a disk-based cache for storing and retrieving Large Language Model (LLM) responses. It provides functionality to save and load cached data from a JSON file, using deterministic keys derived from file paths and content hashes. The cache supports storing individual response entries and tracking progress of processed modules. The implementation ensures data persistence by writing changes to disk upon modification.</p>
<h2 id="ResponseCache">Class: ResponseCache</h2>
<p>The `ResponseCache` class provides persistent storage for mapping stable keys to LLM responses using a JSON file. It supports retrieving and storing cached values, managing progress tracking for processed modules, and ensuring data durability through disk serialization. The class includes methods for key generation based on file paths and content hashes, as well as operations to clear or update progress information.</p>
<h3 id="__init__">Method: __init__(self, path: str) -&gt; None</h3>
<p>Initializes the ResponseCache instance by loading cached data from a specified file path. If the file exists and contains valid JSON data, it loads the data into the `_data` attribute; otherwise, it initializes an empty dictionary. Ensures that a `__progress__` key exists in the data to track progress.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>, path: <span style="color: #008000">str</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #008000">self</span><span style="color: #666666">.</span>file <span style="color: #666666">=</span> Path(path)
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>file<span style="color: #666666">.</span>exists():
            <span style="color: #008000; font-weight: bold">try</span>:
                <span style="color: #008000">self</span><span style="color: #666666">.</span>_data: Dict[<span style="color: #008000">str</span>, Any] <span style="color: #666666">=</span> json<span style="color: #666666">.</span>loads(
                    <span style="color: #008000">self</span><span style="color: #666666">.</span>file<span style="color: #666666">.</span>read_text(encoding<span style="color: #666666">=</span><span style="color: #BA2121">&quot;utf-8&quot;</span>)
                )
            <span style="color: #008000; font-weight: bold">except</span> json<span style="color: #666666">.</span>JSONDecodeError:
                <span style="color: #008000">self</span><span style="color: #666666">.</span>_data <span style="color: #666666">=</span> {}
        <span style="color: #008000; font-weight: bold">else</span>:
            <span style="color: #008000">self</span><span style="color: #666666">.</span>_data <span style="color: #666666">=</span> {}
        <span style="color: #3D7B7B; font-style: italic"># ensure progress map exists</span>
        <span style="color: #008000">self</span><span style="color: #666666">.</span>_data<span style="color: #666666">.</span>setdefault(<span style="color: #BA2121">&quot;__progress__&quot;</span>, {})
</code></pre>
<h3 id="make_key">Method: make_key(file_path: str, content: str) -&gt; str</h3>
<p>The function `make_key` generates a deterministic key for a given file path and content by creating a SHA-256 hash of the content encoded in UTF-8 and concatenating it with the file path, separated by a colon. This key can be used to uniquely identify a specific file and its content combination.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">make_key</span>(file_path: <span style="color: #008000">str</span>, content: <span style="color: #008000">str</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000">str</span>:
<span style="color: #bbbbbb">        </span><span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Return a deterministic key for *file_path* and *content*.&quot;&quot;&quot;</span>
        digest <span style="color: #666666">=</span> hashlib<span style="color: #666666">.</span>sha256(content<span style="color: #666666">.</span>encode(<span style="color: #BA2121">&quot;utf-8&quot;</span>))<span style="color: #666666">.</span>hexdigest()
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">f&quot;</span><span style="color: #A45A77; font-weight: bold">{</span>file_path<span style="color: #A45A77; font-weight: bold">}</span><span style="color: #BA2121">:</span><span style="color: #A45A77; font-weight: bold">{</span>digest<span style="color: #A45A77; font-weight: bold">}</span><span style="color: #BA2121">&quot;</span>
</code></pre>
<h3 id="get">Method: get(self, key: str) -&gt; Optional[str]</h3>
<p>The `get` method retrieves a cached value associated with the specified key from the internal data storage of the `ResponseCache` class. It takes a string key as input and returns the corresponding cached value if it exists, or None if the key is not found. The method accesses the cached data through the `_data` attribute using the standard dictionary `get` method.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">get</span>(<span style="color: #008000">self</span>, key: <span style="color: #008000">str</span>) <span style="color: #666666">-&gt;</span> Optional[<span style="color: #008000">str</span>]:
<span style="color: #bbbbbb">        </span><span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Return the cached value for ``key`` if present.&quot;&quot;&quot;</span>
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>_data<span style="color: #666666">.</span>get(key)
</code></pre>
<h3 id="set">Method: set(self, key: str, value: str) -&gt; None</h3>
<p>The `set` method in the `ResponseCache` class stores a string value under a specified key in an internal data structure and immediately persists this data to disk. The method takes two parameters: `key` (a string identifier) and `value` (a string value to be stored). After storing the value, it calls the `_save()` method to ensure the data is written to disk.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">set</span>(<span style="color: #008000">self</span>, key: <span style="color: #008000">str</span>, value: <span style="color: #008000">str</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
<span style="color: #bbbbbb">        </span><span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Store ``value`` under ``key`` and persist to disk.&quot;&quot;&quot;</span>
        <span style="color: #008000">self</span><span style="color: #666666">.</span>_data[key] <span style="color: #666666">=</span> value
        <span style="color: #008000">self</span><span style="color: #666666">.</span>_save()
</code></pre>
<h3 id="get_progress">Method: get_progress(self) -&gt; Dict[str, Any]</h3>
<p>The function `get_progress` retrieves and returns a shallow copy of the progress tracking data stored in the `_data` attribute of the `ResponseCache` class. The progress data maps processed module paths to their corresponding information. By returning a copy, the function prevents external modifications to the internal progress mapping.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">get_progress</span>(<span style="color: #008000">self</span>) <span style="color: #666666">-&gt;</span> Dict[<span style="color: #008000">str</span>, Any]:
<span style="color: #bbbbbb">        </span><span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Return the mapping of processed module paths to their data.&quot;&quot;&quot;</span>
        progress <span style="color: #666666">=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>_data<span style="color: #666666">.</span>get(<span style="color: #BA2121">&quot;__progress__&quot;</span>, {})
        <span style="color: #3D7B7B; font-style: italic"># return a shallow copy to prevent accidental mutation</span>
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">dict</span>(progress)
</code></pre>
<h3 id="set_progress_entry">Method: set_progress_entry(self, path: str, module_data: Dict[str, Any]) -&gt; None</h3>
<p>Records module data for a specified path in the progress map and saves the updated data.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">set_progress_entry</span>(<span style="color: #008000">self</span>, path: <span style="color: #008000">str</span>, module_data: Dict[<span style="color: #008000">str</span>, Any]) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
<span style="color: #bbbbbb">        </span><span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Record ``module_data`` for ``path`` in the progress map.&quot;&quot;&quot;</span>
        progress <span style="color: #666666">=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>_data<span style="color: #666666">.</span>setdefault(<span style="color: #BA2121">&quot;__progress__&quot;</span>, {})
        progress[path] <span style="color: #666666">=</span> module_data
        <span style="color: #008000">self</span><span style="color: #666666">.</span>_save()
</code></pre>
<h3 id="clear_progress">Method: clear_progress(self) -&gt; None</h3>
<p>The `clear_progress` method removes all saved progress information by resetting the `&quot;__progress__&quot;` key in the internal data dictionary to an empty dictionary, then saves the updated state.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">clear_progress</span>(<span style="color: #008000">self</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
<span style="color: #bbbbbb">        </span><span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Remove all saved progress information.&quot;&quot;&quot;</span>
        <span style="color: #008000">self</span><span style="color: #666666">.</span>_data[<span style="color: #BA2121">&quot;__progress__&quot;</span>] <span style="color: #666666">=</span> {}
        <span style="color: #008000">self</span><span style="color: #666666">.</span>_save()
</code></pre>
<h3 id="_save">Method: _save(self) -&gt; None</h3>
<p>The `_save` method in the `ResponseCache` class serializes the cached data stored in `self._data` to a JSON format and writes it to a file specified by `self.file`. The JSON output is formatted with an indentation of two spaces and keys are sorted alphabetically. The file is written using UTF-8 encoding. This method persists the cache data to disk.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">_save</span>(<span style="color: #008000">self</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #008000">self</span><span style="color: #666666">.</span>file<span style="color: #666666">.</span>write_text(json<span style="color: #666666">.</span>dumps(<span style="color: #008000">self</span><span style="color: #666666">.</span>_data, indent<span style="color: #666666">=2</span>, sort_keys<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">True</span>), encoding<span style="color: #666666">=</span><span style="color: #BA2121">&quot;utf-8&quot;</span>)
</code></pre>
    </div>
    <script src="static/toggle.js"></script>
</body>
</html>
