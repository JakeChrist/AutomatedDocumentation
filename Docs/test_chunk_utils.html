<!-- Generated by DocGen-LM -->
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/><meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>test_chunk_utils</title>
<link href="static/style.css" rel="stylesheet"/>
</head>
<body><a class="skip-link" href="#main-content">Skip to main content</a><header class="topbar"><button aria-label="Toggle navigation menu" id="sidebar-toggle">Menu</button><span class="topbar-title">test_chunk_utils</span></header>
<nav aria-label="Documentation navigation" class="sidebar">
<h2>Navigation</h2>
<ul><li><a href="index.html"><strong>üè† Project Overview</strong></a></li><li><a href="cache.html">cache</a></li><li><a href="chunk_utils.html">chunk_utils</a></li><li><a href="docgenerator.html">docgenerator</a></li><li><a href="explaincode.html">explaincode</a></li><li><a href="gui_wrapper.html">gui_wrapper</a></li><li><a href="html_writer.html">html_writer</a></li><li><a href="llm_client.html">llm_client</a></li><li><a href="manual_utils.html">manual_utils</a></li><li><a href="parser_cpp.html">parser_cpp</a></li><li><a href="parser_java.html">parser_java</a></li><li><a href="parser_matlab.html">parser_matlab</a></li><li><a href="parser_python.html">parser_python</a></li><li><a href="retrofit_sidebar.html">retrofit_sidebar</a></li><li><a href="reviewer.html">reviewer</a></li><li><a href="sanitize_docs.html">sanitize_docs</a></li><li><a href="scanner.html">scanner</a></li><li><a href="setup.html">setup</a></li><li><a href="summarize_utils.html">summarize_utils</a></li><li><details><summary>tests</summary><ul><li><a href="test_cache.html">test_cache</a></li><li><a href="test_chunk_utils.html">test_chunk_utils</a></li><li><a href="test_docgenerator.html">test_docgenerator</a></li><li><a href="test_docgenerator_subclasses.html">test_docgenerator_subclasses</a></li><li><a href="test_explaincode.html">test_explaincode</a></li><li><a href="test_html_writer.html">test_html_writer</a></li><li><a href="test_integration.html">test_integration</a></li><li><a href="test_llm_client.html">test_llm_client</a></li><li><a href="test_manual_utils.html">test_manual_utils</a></li><li><a href="test_parser_cpp.html">test_parser_cpp</a></li><li><a href="test_parser_java.html">test_parser_java</a></li><li><a href="test_parser_matlab.html">test_parser_matlab</a></li><li><a href="test_parser_python.html">test_parser_python</a></li><li><a href="test_resume_progress.html">test_resume_progress</a></li><li><a href="test_retrofit_sidebar.html">test_retrofit_sidebar</a></li><li><a href="test_reviewer.html">test_reviewer</a></li><li><a href="test_sanitize_docs.html">test_sanitize_docs</a></li><li><a href="test_scanner.html">test_scanner</a></li></ul></details></li></ul>
</nav>
<main class="content" id="main-content" role="main">
<h1>test_chunk_utils</h1>
<p>Module defines tests for tokenization and text chunking functionality. Tests verify tokenizer round-trip encoding/decoding, removal of FIM tokens, proper reconstruction of text from chunks, splitting of markdown headings, and preservation of code blocks during chunking. Uses `chunk_utils` module for chunking and tokenizer retrieval. Contains four test functions covering different aspects of text processing behavior.</p>
<h2>Functions</h2>
<h3 id="test_get_tokenizer_roundtrip">test_get_tokenizer_roundtrip() -&gt; None</h3>
<p>The function `test_get_tokenizer_roundtrip` tests the round-trip functionality of a tokenizer. It retrieves a tokenizer, encodes a sample text ("hello world") into tokens, verifies that the result is a list, decodes the tokens back into text, and asserts that the decoded text matches the original when stripped of whitespace.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_get_tokenizer_roundtrip</span>() <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    tokenizer <span style="color: #666666">=</span> get_tokenizer()
    text <span style="color: #666666">=</span> <span style="color: #BA2121">"hello world"</span>
    tokens <span style="color: #666666">=</span> tokenizer<span style="color: #666666">.</span>encode(text)
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #008000">isinstance</span>(tokens, <span style="color: #008000">list</span>)
    decoded <span style="color: #666666">=</span> tokenizer<span style="color: #666666">.</span>decode(tokens)
    <span style="color: #008000; font-weight: bold">assert</span> decoded<span style="color: #666666">.</span>strip() <span style="color: #666666">==</span> <span style="color: #BA2121">"hello world"</span>
</code></pre>
<h3 id="test_get_tokenizer_strips_fim_tokens">test_get_tokenizer_strips_fim_tokens() -&gt; None</h3>
<p>The function tests that the tokenizer removes FIM (Fill-In-Middle) tokens from text. It retrieves a tokenizer, encodes a string containing FIM tokens, decodes the resulting tokens, and asserts that the decoded output does not contain FIM tokens and matches the expected clean text "hello world".</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_get_tokenizer_strips_fim_tokens</span>() <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    tokenizer <span style="color: #666666">=</span> get_tokenizer()
    text <span style="color: #666666">=</span> <span style="color: #BA2121">"hello &lt;|fim_prefix|&gt; world &lt;|fim_suffix|&gt;"</span>
    tokens <span style="color: #666666">=</span> tokenizer<span style="color: #666666">.</span>encode(text)
    decoded <span style="color: #666666">=</span> tokenizer<span style="color: #666666">.</span>decode(tokens)
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #BA2121">"&lt;|fim_prefix|&gt;"</span> <span style="color: #AA22FF; font-weight: bold">not</span> <span style="color: #AA22FF; font-weight: bold">in</span> decoded
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #BA2121">"&lt;|fim_suffix|&gt;"</span> <span style="color: #AA22FF; font-weight: bold">not</span> <span style="color: #AA22FF; font-weight: bold">in</span> decoded
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #BA2121">" "</span><span style="color: #666666">.</span>join(decoded<span style="color: #666666">.</span>split()) <span style="color: #666666">==</span> <span style="color: #BA2121">"hello world"</span>
</code></pre>
<h3 id="test_chunk_text_reconstructs_content">test_chunk_text_reconstructs_content() -&gt; None</h3>
<p>The function `test_chunk_text_reconstructs_content` verifies that text chunking preserves the original content. It uses a tokenizer to split a generated text string into chunks with a specified token limit, then checks that concatenating the chunks reproduces the original text (with leading/trailing whitespace removed) and confirms that multiple chunks are produced.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_chunk_text_reconstructs_content</span>() <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    tokenizer <span style="color: #666666">=</span> get_tokenizer()
    text <span style="color: #666666">=</span> <span style="color: #BA2121">"word "</span> <span style="color: #666666">*</span> <span style="color: #666666">50</span>
    chunks <span style="color: #666666">=</span> chunk_text(text, tokenizer, <span style="color: #666666">10</span>)
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #BA2121">""</span><span style="color: #666666">.</span>join(chunks) <span style="color: #666666">==</span> text<span style="color: #666666">.</span>strip()
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #008000">len</span>(chunks) <span style="color: #666666">&gt;</span> <span style="color: #666666">1</span>
</code></pre>
<h3 id="test_chunk_text_splits_markdown_headings">test_chunk_text_splits_markdown_headings() -&gt; None</h3>
<p>The function `test_chunk_text_splits_markdown_headings` tests the behavior of the `chunk_text` function when processing Markdown-formatted text containing headings. It verifies that the text is correctly split into chunks based on a specified token limit, ensuring each chunk starts with the appropriate heading. The test uses a tokenizer to determine token counts and checks that the resulting chunks match the expected number and content.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_chunk_text_splits_markdown_headings</span>() <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    tokenizer <span style="color: #666666">=</span> get_tokenizer()
    text <span style="color: #666666">=</span> <span style="color: #BA2121">"# H1</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">para1</span><span style="color: #AA5D1F; font-weight: bold">\n\n</span><span style="color: #BA2121"># H2</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">para2"</span>
    chunks <span style="color: #666666">=</span> chunk_text(text, tokenizer, <span style="color: #666666">4</span>)
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #008000">len</span>(chunks) <span style="color: #666666">==</span> <span style="color: #666666">2</span>
    <span style="color: #008000; font-weight: bold">assert</span> chunks[<span style="color: #666666">0</span>]<span style="color: #666666">.</span>startswith(<span style="color: #BA2121">"# H1"</span>)
    <span style="color: #008000; font-weight: bold">assert</span> chunks[<span style="color: #666666">1</span>]<span style="color: #666666">.</span>startswith(<span style="color: #BA2121">"# H2"</span>)
</code></pre>
<h3 id="test_chunk_text_preserves_code_blocks">test_chunk_text_preserves_code_blocks() -&gt; None</h3>
<p>The function `test_chunk_text_preserves_code_blocks` tests that text chunking preserves code blocks within the input text. It uses a tokenizer to split a sample text containing a Python code block into chunks of a specified size. The test verifies that the code block remains intact across chunks and that each chunk either contains no code blocks or exactly two backticks (indicating a complete code block).</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_chunk_text_preserves_code_blocks</span>() <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    tokenizer <span style="color: #666666">=</span> get_tokenizer()
    text <span style="color: #666666">=</span> <span style="color: #BA2121">"Intro</span><span style="color: #AA5D1F; font-weight: bold">\n\n</span><span style="color: #BA2121">```python</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">print('hi')</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">```</span><span style="color: #AA5D1F; font-weight: bold">\n\n</span><span style="color: #BA2121">Conclusion"</span>
    chunks <span style="color: #666666">=</span> chunk_text(text, tokenizer, <span style="color: #666666">4</span>)
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #008000">any</span>(<span style="color: #BA2121">"```python</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">print('hi')</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">```"</span> <span style="color: #AA22FF; font-weight: bold">in</span> chunk <span style="color: #008000; font-weight: bold">for</span> chunk <span style="color: #AA22FF; font-weight: bold">in</span> chunks)
    <span style="color: #008000; font-weight: bold">for</span> chunk <span style="color: #AA22FF; font-weight: bold">in</span> chunks:
        <span style="color: #008000; font-weight: bold">assert</span> chunk<span style="color: #666666">.</span>count(<span style="color: #BA2121">"```"</span>) <span style="color: #AA22FF; font-weight: bold">in</span> (<span style="color: #666666">0</span>, <span style="color: #666666">2</span>)
</code></pre>
</main>
<footer aria-label="Page footer" class="page-footer"><p>Generated documentation</p></footer><script src="static/toggle.js"></script>
</body>
</html>
