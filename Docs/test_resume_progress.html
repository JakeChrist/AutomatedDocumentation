<!-- Generated by DocGen-LM -->
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/><meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>test_resume_progress</title>
<link href="static/style.css" rel="stylesheet"/>
</head>
<body><a class="skip-link" href="#main-content">Skip to main content</a><header class="topbar"><button aria-label="Toggle navigation menu" id="sidebar-toggle">Menu</button><span class="topbar-title">test_resume_progress</span></header>
<nav aria-label="Documentation navigation" class="sidebar">
<h2>Navigation</h2>
<ul><li><a href="index.html"><strong>üè† Project Overview</strong></a></li><li><a href="cache.html">cache</a></li><li><a href="chunk_utils.html">chunk_utils</a></li><li><a href="docgenerator.html">docgenerator</a></li><li><a href="explaincode.html">explaincode</a></li><li><a href="gui_wrapper.html">gui_wrapper</a></li><li><a href="html_writer.html">html_writer</a></li><li><a href="llm_client.html">llm_client</a></li><li><a href="manual_utils.html">manual_utils</a></li><li><a href="parser_cpp.html">parser_cpp</a></li><li><a href="parser_java.html">parser_java</a></li><li><a href="parser_matlab.html">parser_matlab</a></li><li><a href="parser_python.html">parser_python</a></li><li><a href="retrofit_sidebar.html">retrofit_sidebar</a></li><li><a href="reviewer.html">reviewer</a></li><li><a href="sanitize_docs.html">sanitize_docs</a></li><li><a href="scanner.html">scanner</a></li><li><a href="setup.html">setup</a></li><li><a href="summarize_utils.html">summarize_utils</a></li><li><details><summary>tests</summary><ul><li><a href="test_cache.html">test_cache</a></li><li><a href="test_chunk_utils.html">test_chunk_utils</a></li><li><a href="test_docgenerator.html">test_docgenerator</a></li><li><a href="test_docgenerator_subclasses.html">test_docgenerator_subclasses</a></li><li><a href="test_explaincode.html">test_explaincode</a></li><li><a href="test_html_writer.html">test_html_writer</a></li><li><a href="test_integration.html">test_integration</a></li><li><a href="test_llm_client.html">test_llm_client</a></li><li><a href="test_manual_utils.html">test_manual_utils</a></li><li><a href="test_parser_cpp.html">test_parser_cpp</a></li><li><a href="test_parser_java.html">test_parser_java</a></li><li><a href="test_parser_matlab.html">test_parser_matlab</a></li><li><a href="test_parser_python.html">test_parser_python</a></li><li><a href="test_resume_progress.html">test_resume_progress</a></li><li><a href="test_retrofit_sidebar.html">test_retrofit_sidebar</a></li><li><a href="test_reviewer.html">test_reviewer</a></li><li><a href="test_sanitize_docs.html">test_sanitize_docs</a></li><li><a href="test_scanner.html">test_scanner</a></li></ul></details></li></ul>
</nav>
<main class="content" id="main-content" role="main">
<h1>test_resume_progress</h1>
<p>Test function that verifies resume functionality of the documentation generator. Sets up a project with two Python modules and simulates a failure during caching of progress. After the failure, it checks that only the first module's progress is recorded in the cache. Then, it runs the generator again with resume flag, verifying that only the second module is processed and both HTML files are generated. The test confirms that the cache state is properly managed across failures and resumptions.</p>
<h2>Functions</h2>
<h3 id="test_resume_progress">test_resume_progress(tmp_path, monkeypatch)</h3>
<p>The function `test_resume_progress` tests the resumption of documentation generation progress after a failure. It sets up a temporary project directory with two Python modules, then mocks several functions from the `docgenerator` module to simulate summarization and docstring rewriting. A `ResponseCache` method is also mocked to simulate a failure during progress saving after processing the first module. The test verifies that the first module's progress is saved in the cache and that the second module is processed upon resuming. It confirms that both modules are eventually documented and that the cache is cleared after successful completion.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_resume_progress</span>(tmp_path, monkeypatch):
    project_dir <span style="color: #666666">=</span> tmp_path <span style="color: #666666">/</span> <span style="color: #BA2121">"proj"</span>
    project_dir<span style="color: #666666">.</span>mkdir()
    (project_dir <span style="color: #666666">/</span> <span style="color: #BA2121">"mod1.py"</span>)<span style="color: #666666">.</span>write_text(<span style="color: #BA2121">"def a():</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">    return 1</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">"</span>, encoding<span style="color: #666666">=</span><span style="color: #BA2121">"utf-8"</span>)
    (project_dir <span style="color: #666666">/</span> <span style="color: #BA2121">"mod2.py"</span>)<span style="color: #666666">.</span>write_text(<span style="color: #BA2121">"def b():</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">    return 2</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">"</span>, encoding<span style="color: #666666">=</span><span style="color: #BA2121">"utf-8"</span>)

    out_dir <span style="color: #666666">=</span> tmp_path <span style="color: #666666">/</span> <span style="color: #BA2121">"docs"</span>

    module_calls <span style="color: #666666">=</span> []

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">fake_summarize_module</span>(client, cache, key_prefix, module_text, module, tokenizer, max_context_tokens, chunk_token_budget):
        path <span style="color: #666666">=</span> key_prefix<span style="color: #666666">.</span>split(<span style="color: #BA2121">":"</span>)[<span style="color: #666666">0</span>]
        module_calls<span style="color: #666666">.</span>append(path)
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">"summary"</span>

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">fake_summarize_chunked</span>(client, cache, key, text, prompt_type, max_context_tokens, chunk_token_budget):
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">"summary"</span>

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">fake_rewrite_docstring</span>(<span style="color: #666666">*</span>args, <span style="color: #666666">**</span>kwargs):
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">None</span>

    monkeypatch<span style="color: #666666">.</span>setattr(docgenerator, <span style="color: #BA2121">"_summarize_module_chunked"</span>, fake_summarize_module)
    monkeypatch<span style="color: #666666">.</span>setattr(docgenerator, <span style="color: #BA2121">"_summarize_chunked"</span>, fake_summarize_chunked)
    monkeypatch<span style="color: #666666">.</span>setattr(docgenerator, <span style="color: #BA2121">"_rewrite_docstring"</span>, fake_rewrite_docstring)
    monkeypatch<span style="color: #666666">.</span>setattr(docgenerator<span style="color: #666666">.</span>LLMClient, <span style="color: #BA2121">"ping"</span>, <span style="color: #008000; font-weight: bold">lambda</span> <span style="color: #008000">self</span>: <span style="color: #008000; font-weight: bold">True</span>)

    original_set_progress <span style="color: #666666">=</span> ResponseCache<span style="color: #666666">.</span>set_progress_entry
    calls <span style="color: #666666">=</span> {<span style="color: #BA2121">"count"</span>: <span style="color: #666666">0</span>}

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">crashing_set_progress</span>(<span style="color: #008000">self</span>, path, module_data):
        original_set_progress(<span style="color: #008000">self</span>, path, module_data)
        calls[<span style="color: #BA2121">"count"</span>] <span style="color: #666666">+=</span> <span style="color: #666666">1</span>
        <span style="color: #008000; font-weight: bold">if</span> calls[<span style="color: #BA2121">"count"</span>] <span style="color: #666666">==</span> <span style="color: #666666">1</span>:
            <span style="color: #008000; font-weight: bold">raise</span> <span style="color: #CB3F38; font-weight: bold">RuntimeError</span>(<span style="color: #BA2121">"boom"</span>)

    monkeypatch<span style="color: #666666">.</span>setattr(ResponseCache, <span style="color: #BA2121">"set_progress_entry"</span>, crashing_set_progress)

    <span style="color: #008000; font-weight: bold">with</span> pytest<span style="color: #666666">.</span>raises(<span style="color: #CB3F38; font-weight: bold">RuntimeError</span>):
        docgenerator<span style="color: #666666">.</span>main([<span style="color: #BA2121">"--output"</span>, <span style="color: #008000">str</span>(out_dir), <span style="color: #008000">str</span>(project_dir)])

    cache <span style="color: #666666">=</span> ResponseCache(<span style="color: #008000">str</span>(out_dir <span style="color: #666666">/</span> <span style="color: #BA2121">"cache.json"</span>))
    progress <span style="color: #666666">=</span> cache<span style="color: #666666">.</span>get_progress()
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #008000">list</span>(progress<span style="color: #666666">.</span>keys()) <span style="color: #666666">==</span> [<span style="color: #008000">str</span>(project_dir <span style="color: #666666">/</span> <span style="color: #BA2121">"mod1.py"</span>)]

    monkeypatch<span style="color: #666666">.</span>setattr(ResponseCache, <span style="color: #BA2121">"set_progress_entry"</span>, original_set_progress)
    module_calls<span style="color: #666666">.</span>clear()

    ret <span style="color: #666666">=</span> docgenerator<span style="color: #666666">.</span>main([<span style="color: #BA2121">"--output"</span>, <span style="color: #008000">str</span>(out_dir), <span style="color: #008000">str</span>(project_dir), <span style="color: #BA2121">"--resume"</span>])
    <span style="color: #008000; font-weight: bold">assert</span> ret <span style="color: #666666">==</span> <span style="color: #666666">0</span>

    <span style="color: #008000; font-weight: bold">assert</span> [Path(p)<span style="color: #666666">.</span>name <span style="color: #008000; font-weight: bold">for</span> p <span style="color: #AA22FF; font-weight: bold">in</span> module_calls] <span style="color: #666666">==</span> [<span style="color: #BA2121">"mod2.py"</span>]
    <span style="color: #008000; font-weight: bold">assert</span> (out_dir <span style="color: #666666">/</span> <span style="color: #BA2121">"mod1.html"</span>)<span style="color: #666666">.</span>exists()
    <span style="color: #008000; font-weight: bold">assert</span> (out_dir <span style="color: #666666">/</span> <span style="color: #BA2121">"mod2.html"</span>)<span style="color: #666666">.</span>exists()

    cache2 <span style="color: #666666">=</span> ResponseCache(<span style="color: #008000">str</span>(out_dir <span style="color: #666666">/</span> <span style="color: #BA2121">"cache.json"</span>))
    <span style="color: #008000; font-weight: bold">assert</span> cache2<span style="color: #666666">.</span>get_progress() <span style="color: #666666">==</span> {}
</code></pre>
<details>
<summary>Subfunction: fake_summarize_module(client, cache, key_prefix, module_text, module, tokenizer, max_context_tokens, chunk_token_budget)</summary>
<h4 id="fake_summarize_module">fake_summarize_module(client, cache, key_prefix, module_text, module, tokenizer, max_context_tokens, chunk_token_budget)</h4>
<p>The function `fake_summarize_module` is a placeholder implementation that simulates the behavior of a module summarization process. It takes several parameters including a client, cache, key prefix, module text, module name, tokenizer, maximum context tokens, and chunk token budget. The function extracts a path from the key prefix, appends it to a global list `module_calls`, and returns a static string "summary". This implementation does not perform actual summarization but serves as a mockup for testing or demonstration purposes.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">fake_summarize_module</span>(client, cache, key_prefix, module_text, module, tokenizer, max_context_tokens, chunk_token_budget):
        path <span style="color: #666666">=</span> key_prefix<span style="color: #666666">.</span>split(<span style="color: #BA2121">":"</span>)[<span style="color: #666666">0</span>]
        module_calls<span style="color: #666666">.</span>append(path)
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">"summary"</span>
</code></pre>
</details>
<details>
<summary>Subfunction: fake_summarize_chunked(client, cache, key, text, prompt_type, max_context_tokens, chunk_token_budget)</summary>
<h4 id="fake_summarize_chunked">fake_summarize_chunked(client, cache, key, text, prompt_type, max_context_tokens, chunk_token_budget)</h4>
<p>The function `fake_summarize_chunked` is a placeholder implementation that takes parameters related to client configuration, caching, text processing, and summarization settings, but always returns the string "summary" regardless of the input. It appears to be used for testing or demonstration purposes where actual summarization logic is not required.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">fake_summarize_chunked</span>(client, cache, key, text, prompt_type, max_context_tokens, chunk_token_budget):
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">"summary"</span>
</code></pre>
</details>
<details>
<summary>Subfunction: fake_rewrite_docstring(*args, **kwargs)</summary>
<h4 id="fake_rewrite_docstring">fake_rewrite_docstring(*args, **kwargs)</h4>
<p>The function `fake_rewrite_docstring` is defined to accept any number of positional and keyword arguments, but always returns `None`. It appears to be a placeholder or dummy implementation that does not perform any actual docstring rewriting functionality.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">fake_rewrite_docstring</span>(<span style="color: #666666">*</span>args, <span style="color: #666666">**</span>kwargs):
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">None</span>
</code></pre>
</details>
<details>
<summary>Subfunction: crashing_set_progress(self, path, module_data)</summary>
<h4 id="crashing_set_progress">crashing_set_progress(self, path, module_data)</h4>
<p>The function `crashing_set_progress` overrides the behavior of `original_set_progress` by first calling it with the provided arguments `path` and `module_data`. It then increments a counter stored in the global dictionary `calls` under the key `"count"`. If this counter reaches the value 1, the function raises a `RuntimeError` with the message "boom". This implementation appears to be designed to simulate or induce an error on the first invocation while allowing subsequent calls to proceed normally.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">crashing_set_progress</span>(<span style="color: #008000">self</span>, path, module_data):
        original_set_progress(<span style="color: #008000">self</span>, path, module_data)
        calls[<span style="color: #BA2121">"count"</span>] <span style="color: #666666">+=</span> <span style="color: #666666">1</span>
        <span style="color: #008000; font-weight: bold">if</span> calls[<span style="color: #BA2121">"count"</span>] <span style="color: #666666">==</span> <span style="color: #666666">1</span>:
            <span style="color: #008000; font-weight: bold">raise</span> <span style="color: #CB3F38; font-weight: bold">RuntimeError</span>(<span style="color: #BA2121">"boom"</span>)
</code></pre>
</details>
</main>
<footer aria-label="Page footer" class="page-footer"><p>Generated documentation</p></footer><script src="static/toggle.js"></script>
</body>
</html>
