<!-- Generated by DocGen-LM -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>test_resume_progress</title>
    <link rel="stylesheet" href="static/style.css">
</head>
<body>
    <button id="sidebar-toggle">Menu</button>
    <div class="sidebar">
        <h2>Navigation</h2>
        <ul><li><a href="index.html"><strong>üè† Project Overview</strong></a></li><li><a href="cache.html">cache</a></li><li><a href="chunk_utils.html">chunk_utils</a></li><li><a href="docgenerator.html">docgenerator</a></li><li><a href="explaincode.html">explaincode</a></li><li><a href="gui_wrapper.html">gui_wrapper</a></li><li><a href="html_writer.html">html_writer</a></li><li><a href="llm_client.html">llm_client</a></li><li><a href="manual_utils.html">manual_utils</a></li><li><a href="parser_cpp.html">parser_cpp</a></li><li><a href="parser_java.html">parser_java</a></li><li><a href="parser_matlab.html">parser_matlab</a></li><li><a href="parser_python.html">parser_python</a></li><li><a href="retrofit_sidebar.html">retrofit_sidebar</a></li><li><a href="reviewer.html">reviewer</a></li><li><a href="sanitize_docs.html">sanitize_docs</a></li><li><a href="scanner.html">scanner</a></li><li><a href="setup.html">setup</a></li><li><a href="summarize_utils.html">summarize_utils</a></li><li><details><summary>tests</summary><ul><li><a href="test_cache.html">test_cache</a></li><li><a href="test_chunk_utils.html">test_chunk_utils</a></li><li><a href="test_docgenerator.html">test_docgenerator</a></li><li><a href="test_docgenerator_subclasses.html">test_docgenerator_subclasses</a></li><li><a href="test_explaincode.html">test_explaincode</a></li><li><a href="test_html_writer.html">test_html_writer</a></li><li><a href="test_integration.html">test_integration</a></li><li><a href="test_llm_client.html">test_llm_client</a></li><li><a href="test_manual_utils.html">test_manual_utils</a></li><li><a href="test_parser_cpp.html">test_parser_cpp</a></li><li><a href="test_parser_java.html">test_parser_java</a></li><li><a href="test_parser_matlab.html">test_parser_matlab</a></li><li><a href="test_parser_python.html">test_parser_python</a></li><li><a href="test_resume_progress.html">test_resume_progress</a></li><li><a href="test_retrofit_sidebar.html">test_retrofit_sidebar</a></li><li><a href="test_reviewer.html">test_reviewer</a></li><li><a href="test_sanitize_docs.html">test_sanitize_docs</a></li><li><a href="test_scanner.html">test_scanner</a></li></ul></details></li></ul>
    </div>
    <div class="content">
        <h1>test_resume_progress</h1>
        <p>Test function that verifies resume functionality of documentation generation with caching. Sets up a project with two Python modules and mocks various docgenerator functions to simulate processing. Configures a mock cache that raises an exception on the first progress update to simulate a failure. Executes main generation process which fails, then resumes it. Verifies that only the second module is processed after resuming, and that both HTML files are generated. Confirms cache progress tracking behavior and ensures all modules are eventually documented.</p>
<h2>Functions</h2>
<h3 id="test_resume_progress">test_resume_progress(tmp_path, monkeypatch)</h3>
<p>The function `test_resume_progress` tests the resumable documentation generation feature of the tool. It creates a temporary project with two Python modules, `mod1.py` and `mod2.py`, each containing a single function. The test mocks various internal functions of the documentation generator to simulate summarization and docstring rewriting, and also simulates a failure during progress saving on the first run.

On the first execution without resume, the function raises a `RuntimeError` due to the mocked failure, and verifies that progress is saved only for the first module (`mod1.py`). On the second execution with the `--resume` flag, it verifies that the generation resumes from where it left off, processes the remaining module (`mod2.py`), and successfully generates HTML documentation for both modules. It also confirms that the cache progress is cleared after a successful resume run.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_resume_progress</span>(tmp_path, monkeypatch):
    project_dir <span style="color: #666666">=</span> tmp_path <span style="color: #666666">/</span> <span style="color: #BA2121">&quot;proj&quot;</span>
    project_dir<span style="color: #666666">.</span>mkdir()
    (project_dir <span style="color: #666666">/</span> <span style="color: #BA2121">&quot;mod1.py&quot;</span>)<span style="color: #666666">.</span>write_text(<span style="color: #BA2121">&quot;def a():</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">    return 1</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">&quot;</span>, encoding<span style="color: #666666">=</span><span style="color: #BA2121">&quot;utf-8&quot;</span>)
    (project_dir <span style="color: #666666">/</span> <span style="color: #BA2121">&quot;mod2.py&quot;</span>)<span style="color: #666666">.</span>write_text(<span style="color: #BA2121">&quot;def b():</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">    return 2</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">&quot;</span>, encoding<span style="color: #666666">=</span><span style="color: #BA2121">&quot;utf-8&quot;</span>)

    out_dir <span style="color: #666666">=</span> tmp_path <span style="color: #666666">/</span> <span style="color: #BA2121">&quot;docs&quot;</span>

    module_calls <span style="color: #666666">=</span> []

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">fake_summarize_module</span>(client, cache, key_prefix, module_text, module, tokenizer, max_context_tokens, chunk_token_budget):
        path <span style="color: #666666">=</span> key_prefix<span style="color: #666666">.</span>split(<span style="color: #BA2121">&quot;:&quot;</span>)[<span style="color: #666666">0</span>]
        module_calls<span style="color: #666666">.</span>append(path)
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">&quot;summary&quot;</span>

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">fake_summarize_chunked</span>(client, cache, key, text, prompt_type, max_context_tokens, chunk_token_budget):
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">&quot;summary&quot;</span>

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">fake_rewrite_docstring</span>(<span style="color: #666666">*</span>args, <span style="color: #666666">**</span>kwargs):
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">None</span>

    monkeypatch<span style="color: #666666">.</span>setattr(docgenerator, <span style="color: #BA2121">&quot;_summarize_module_chunked&quot;</span>, fake_summarize_module)
    monkeypatch<span style="color: #666666">.</span>setattr(docgenerator, <span style="color: #BA2121">&quot;_summarize_chunked&quot;</span>, fake_summarize_chunked)
    monkeypatch<span style="color: #666666">.</span>setattr(docgenerator, <span style="color: #BA2121">&quot;_rewrite_docstring&quot;</span>, fake_rewrite_docstring)
    monkeypatch<span style="color: #666666">.</span>setattr(docgenerator<span style="color: #666666">.</span>LLMClient, <span style="color: #BA2121">&quot;ping&quot;</span>, <span style="color: #008000; font-weight: bold">lambda</span> <span style="color: #008000">self</span>: <span style="color: #008000; font-weight: bold">True</span>)

    original_set_progress <span style="color: #666666">=</span> ResponseCache<span style="color: #666666">.</span>set_progress_entry
    calls <span style="color: #666666">=</span> {<span style="color: #BA2121">&quot;count&quot;</span>: <span style="color: #666666">0</span>}

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">crashing_set_progress</span>(<span style="color: #008000">self</span>, path, module_data):
        original_set_progress(<span style="color: #008000">self</span>, path, module_data)
        calls[<span style="color: #BA2121">&quot;count&quot;</span>] <span style="color: #666666">+=</span> <span style="color: #666666">1</span>
        <span style="color: #008000; font-weight: bold">if</span> calls[<span style="color: #BA2121">&quot;count&quot;</span>] <span style="color: #666666">==</span> <span style="color: #666666">1</span>:
            <span style="color: #008000; font-weight: bold">raise</span> <span style="color: #CB3F38; font-weight: bold">RuntimeError</span>(<span style="color: #BA2121">&quot;boom&quot;</span>)

    monkeypatch<span style="color: #666666">.</span>setattr(ResponseCache, <span style="color: #BA2121">&quot;set_progress_entry&quot;</span>, crashing_set_progress)

    <span style="color: #008000; font-weight: bold">with</span> pytest<span style="color: #666666">.</span>raises(<span style="color: #CB3F38; font-weight: bold">RuntimeError</span>):
        docgenerator<span style="color: #666666">.</span>main([<span style="color: #BA2121">&quot;--output&quot;</span>, <span style="color: #008000">str</span>(out_dir), <span style="color: #008000">str</span>(project_dir)])

    cache <span style="color: #666666">=</span> ResponseCache(<span style="color: #008000">str</span>(out_dir <span style="color: #666666">/</span> <span style="color: #BA2121">&quot;cache.json&quot;</span>))
    progress <span style="color: #666666">=</span> cache<span style="color: #666666">.</span>get_progress()
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #008000">list</span>(progress<span style="color: #666666">.</span>keys()) <span style="color: #666666">==</span> [<span style="color: #008000">str</span>(project_dir <span style="color: #666666">/</span> <span style="color: #BA2121">&quot;mod1.py&quot;</span>)]

    monkeypatch<span style="color: #666666">.</span>setattr(ResponseCache, <span style="color: #BA2121">&quot;set_progress_entry&quot;</span>, original_set_progress)
    module_calls<span style="color: #666666">.</span>clear()

    ret <span style="color: #666666">=</span> docgenerator<span style="color: #666666">.</span>main([<span style="color: #BA2121">&quot;--output&quot;</span>, <span style="color: #008000">str</span>(out_dir), <span style="color: #008000">str</span>(project_dir), <span style="color: #BA2121">&quot;--resume&quot;</span>])
    <span style="color: #008000; font-weight: bold">assert</span> ret <span style="color: #666666">==</span> <span style="color: #666666">0</span>

    <span style="color: #008000; font-weight: bold">assert</span> [Path(p)<span style="color: #666666">.</span>name <span style="color: #008000; font-weight: bold">for</span> p <span style="color: #AA22FF; font-weight: bold">in</span> module_calls] <span style="color: #666666">==</span> [<span style="color: #BA2121">&quot;mod2.py&quot;</span>]
    <span style="color: #008000; font-weight: bold">assert</span> (out_dir <span style="color: #666666">/</span> <span style="color: #BA2121">&quot;mod1.html&quot;</span>)<span style="color: #666666">.</span>exists()
    <span style="color: #008000; font-weight: bold">assert</span> (out_dir <span style="color: #666666">/</span> <span style="color: #BA2121">&quot;mod2.html&quot;</span>)<span style="color: #666666">.</span>exists()

    cache2 <span style="color: #666666">=</span> ResponseCache(<span style="color: #008000">str</span>(out_dir <span style="color: #666666">/</span> <span style="color: #BA2121">&quot;cache.json&quot;</span>))
    <span style="color: #008000; font-weight: bold">assert</span> cache2<span style="color: #666666">.</span>get_progress() <span style="color: #666666">==</span> {}
</code></pre>
<details>
<summary>Subfunction: fake_summarize_module(client, cache, key_prefix, module_text, module, tokenizer, max_context_tokens, chunk_token_budget)</summary>
<h4 id="fake_summarize_module">fake_summarize_module(client, cache, key_prefix, module_text, module, tokenizer, max_context_tokens, chunk_token_budget)</h4>
<p>The function `fake_summarize_module` is a placeholder implementation that simulates the process of summarizing a code module. It takes parameters including an LLM client, cache object, key prefix, module text, module name, tokenizer, maximum context tokens, and chunk token budget. The function extracts a path from the key prefix, appends it to a global list `module_calls`, and returns a static string &quot;summary&quot; without performing any actual summarization. This function appears to be used for testing or demonstration purposes where real LLM integration is not required.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">fake_summarize_module</span>(client, cache, key_prefix, module_text, module, tokenizer, max_context_tokens, chunk_token_budget):
        path <span style="color: #666666">=</span> key_prefix<span style="color: #666666">.</span>split(<span style="color: #BA2121">&quot;:&quot;</span>)[<span style="color: #666666">0</span>]
        module_calls<span style="color: #666666">.</span>append(path)
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">&quot;summary&quot;</span>
</code></pre>
</details>
<details>
<summary>Subfunction: fake_summarize_chunked(client, cache, key, text, prompt_type, max_context_tokens, chunk_token_budget)</summary>
<h4 id="fake_summarize_chunked">fake_summarize_chunked(client, cache, key, text, prompt_type, max_context_tokens, chunk_token_budget)</h4>
<p>The function `fake_summarize_chunked` is a placeholder implementation that takes parameters related to client configuration, caching, text processing, and prompting, but always returns the string &quot;summary&quot; regardless of the input. It appears to be a mock version of a chunked text summarization function, likely used for testing or demonstration purposes where actual LLM interaction is not required.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">fake_summarize_chunked</span>(client, cache, key, text, prompt_type, max_context_tokens, chunk_token_budget):
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">&quot;summary&quot;</span>
</code></pre>
</details>
<details>
<summary>Subfunction: fake_rewrite_docstring(*args, **kwargs)</summary>
<h4 id="fake_rewrite_docstring">fake_rewrite_docstring(*args, **kwargs)</h4>
<p>The function `fake_rewrite_docstring` is a placeholder implementation that accepts any number of positional and keyword arguments but always returns `None`. It does not perform any actual docstring rewriting or processing.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">fake_rewrite_docstring</span>(<span style="color: #666666">*</span>args, <span style="color: #666666">**</span>kwargs):
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">None</span>
</code></pre>
</details>
<details>
<summary>Subfunction: crashing_set_progress(self, path, module_data)</summary>
<h4 id="crashing_set_progress">crashing_set_progress(self, path, module_data)</h4>
<p>The function `crashing_set_progress` is a wrapper around an original `set_progress` function that increments a call counter stored in the `calls` dictionary. When the counter reaches one, it raises a `RuntimeError` with the message &quot;boom&quot;. This function appears to be designed to simulate or induce a failure on the first invocation while otherwise delegating its behavior to the original progress-setting functionality.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">crashing_set_progress</span>(<span style="color: #008000">self</span>, path, module_data):
        original_set_progress(<span style="color: #008000">self</span>, path, module_data)
        calls[<span style="color: #BA2121">&quot;count&quot;</span>] <span style="color: #666666">+=</span> <span style="color: #666666">1</span>
        <span style="color: #008000; font-weight: bold">if</span> calls[<span style="color: #BA2121">&quot;count&quot;</span>] <span style="color: #666666">==</span> <span style="color: #666666">1</span>:
            <span style="color: #008000; font-weight: bold">raise</span> <span style="color: #CB3F38; font-weight: bold">RuntimeError</span>(<span style="color: #BA2121">&quot;boom&quot;</span>)
</code></pre>
</details>
    </div>
    <script src="static/toggle.js"></script>
</body>
</html>
