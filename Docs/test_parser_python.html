<!-- Generated by DocGen-LM -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>test_parser_python</title>
    <link rel="stylesheet" href="static/style.css">
</head>
<body>
    <button id="sidebar-toggle">Menu</button>
    <div class="sidebar">
        <h2>Navigation</h2>
        <ul>
        <li><a href="index.html"><strong>üè† Project Overview</strong></a></li>
<li><a href="cache.html">cache</a></li>
<li><a href="chunk_utils.html">chunk_utils</a></li>
<li><a href="docgenerator.html">docgenerator</a></li>
<li><a href="explaincode.html">explaincode</a></li>
<li><a href="gui_wrapper.html">gui_wrapper</a></li>
<li><a href="html_writer.html">html_writer</a></li>
<li><a href="llm_client.html">llm_client</a></li>
<li><a href="manual_utils.html">manual_utils</a></li>
<li><a href="parser_cpp.html">parser_cpp</a></li>
<li><a href="parser_java.html">parser_java</a></li>
<li><a href="parser_matlab.html">parser_matlab</a></li>
<li><a href="parser_python.html">parser_python</a></li>
<li><a href="reviewer.html">reviewer</a></li>
<li><a href="scanner.html">scanner</a></li>
<li><a href="setup.html">setup</a></li>
<li><a href="summarize_utils.html">summarize_utils</a></li>
<li><a href="test_cache.html">test_cache</a></li>
<li><a href="test_chunk_utils.html">test_chunk_utils</a></li>
<li><a href="test_docgenerator.html">test_docgenerator</a></li>
<li><a href="test_docgenerator_subclasses.html">test_docgenerator_subclasses</a></li>
<li><a href="test_explaincode.html">test_explaincode</a></li>
<li><a href="test_html_writer.html">test_html_writer</a></li>
<li><a href="test_integration.html">test_integration</a></li>
<li><a href="test_llm_client.html">test_llm_client</a></li>
<li><a href="test_manual_utils.html">test_manual_utils</a></li>
<li><a href="test_parser_cpp.html">test_parser_cpp</a></li>
<li><a href="test_parser_java.html">test_parser_java</a></li>
<li><a href="test_parser_matlab.html">test_parser_matlab</a></li>
<li><a href="test_parser_python.html">test_parser_python</a></li>
<li><a href="test_reviewer.html">test_reviewer</a></li>
<li><a href="test_scanner.html">test_scanner</a></li>
        </ul>
    </div>
    <div class="content">
        <h1>test_parser_python</h1>
        <p>The module defines several test functions to verify the functionality of a `parse_python_file` function. Each test function creates a Python source file with different structures (simple modules, complex signatures, nested classes, deeply nested classes, and class inside methods), writes it to a temporary directory, and then parses it using `parse_python_file`. The tests assert that the parsed results match the expected structure and content of the source files.</p>
<h2>Functions</h2>
<h3 id="test_parse_simple_module">test_parse_simple_module(tmp_path: Path) -&gt; None</h3>
<p>This function tests the parsing of a simple Python module. It creates a temporary file with a sample Python script containing a module docstring, a class with a method, and a standalone function. The `parse_python_file` function is called to parse this file. The test asserts that the parsed result contains the correct module docstring, class name, class docstring, method signature, method docstring, method source code, function name, function signature, return type, function docstring, and function source code.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_parse_simple_module</span>(tmp_path: Path) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    src <span style="color: #666666">=</span> textwrap<span style="color: #666666">.</span>dedent(
<span style="color: #bbbbbb">        </span><span style="color: #BA2121; font-style: italic">&#39;&#39;&#39;</span>
<span style="color: #BA2121; font-style: italic">        &quot;&quot;&quot;Example module.&quot;&quot;&quot;</span>

<span style="color: #BA2121; font-style: italic">        def add(x: int, y: int) -&gt; int:</span>
<span style="color: #BA2121; font-style: italic">            &quot;&quot;&quot;Add two numbers.&quot;&quot;&quot;</span>
<span style="color: #BA2121; font-style: italic">            return x + y</span>

<span style="color: #BA2121; font-style: italic">        class Greeter:</span>
<span style="color: #BA2121; font-style: italic">            &quot;&quot;&quot;Says hi.&quot;&quot;&quot;</span>

<span style="color: #BA2121; font-style: italic">            def greet(self, name: str = &quot;World&quot;) -&gt; str:</span>
<span style="color: #BA2121; font-style: italic">                &quot;&quot;&quot;Return a greeting.&quot;&quot;&quot;</span>
<span style="color: #BA2121; font-style: italic">                return f&quot;Hello, {name}&quot;</span>
<span style="color: #BA2121; font-style: italic">        &#39;&#39;&#39;</span>
    )
    file <span style="color: #666666">=</span> tmp_path <span style="color: #666666">/</span> <span style="color: #BA2121">&quot;sample.py&quot;</span>
    file<span style="color: #666666">.</span>write_text(src)

    result <span style="color: #666666">=</span> parse_python_file(<span style="color: #008000">str</span>(file))

    <span style="color: #008000; font-weight: bold">assert</span> result[<span style="color: #BA2121">&quot;module_docstring&quot;</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;Example module.&quot;</span>
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #008000">len</span>(result[<span style="color: #BA2121">&quot;classes&quot;</span>]) <span style="color: #666666">==</span> <span style="color: #666666">1</span>
    <span style="color: #008000">cls</span> <span style="color: #666666">=</span> result[<span style="color: #BA2121">&quot;classes&quot;</span>][<span style="color: #666666">0</span>]
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #008000">cls</span>[<span style="color: #BA2121">&quot;name&quot;</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;Greeter&quot;</span>
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #008000">cls</span>[<span style="color: #BA2121">&quot;docstring&quot;</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;Says hi.&quot;</span>
    method <span style="color: #666666">=</span> <span style="color: #008000">cls</span>[<span style="color: #BA2121">&quot;methods&quot;</span>][<span style="color: #666666">0</span>]
    <span style="color: #008000; font-weight: bold">assert</span> method[<span style="color: #BA2121">&quot;signature&quot;</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;greet(self, name: str=&#39;World&#39;) -&gt; str&quot;</span>
    <span style="color: #008000; font-weight: bold">assert</span> method[<span style="color: #BA2121">&quot;docstring&quot;</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;Return a greeting.&quot;</span>
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #BA2121">&quot;def greet&quot;</span> <span style="color: #AA22FF; font-weight: bold">in</span> method[<span style="color: #BA2121">&quot;source&quot;</span>]
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #BA2121">&quot;Return a greeting.&quot;</span> <span style="color: #AA22FF; font-weight: bold">in</span> method[<span style="color: #BA2121">&quot;source&quot;</span>]

    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #008000">len</span>(result[<span style="color: #BA2121">&quot;functions&quot;</span>]) <span style="color: #666666">==</span> <span style="color: #666666">1</span>
    func <span style="color: #666666">=</span> result[<span style="color: #BA2121">&quot;functions&quot;</span>][<span style="color: #666666">0</span>]
    <span style="color: #008000; font-weight: bold">assert</span> func[<span style="color: #BA2121">&quot;name&quot;</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;add&quot;</span>
    <span style="color: #008000; font-weight: bold">assert</span> func[<span style="color: #BA2121">&quot;signature&quot;</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;add(x: int, y: int) -&gt; int&quot;</span>
    <span style="color: #008000; font-weight: bold">assert</span> func[<span style="color: #BA2121">&quot;returns&quot;</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;int&quot;</span>
    <span style="color: #008000; font-weight: bold">assert</span> func[<span style="color: #BA2121">&quot;docstring&quot;</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;Add two numbers.&quot;</span>
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #BA2121">&quot;def add&quot;</span> <span style="color: #AA22FF; font-weight: bold">in</span> func[<span style="color: #BA2121">&quot;source&quot;</span>]
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #BA2121">&quot;Add two numbers.&quot;</span> <span style="color: #AA22FF; font-weight: bold">in</span> func[<span style="color: #BA2121">&quot;source&quot;</span>]
</code></pre>
<h3 id="test_parse_complex_signature">test_parse_complex_signature(tmp_path: Path) -&gt; None</h3>
<p>This function `test_parse_complex_signature` tests the parsing of a Python file containing a complex function signature. It creates a temporary Python file with a docstring and a function definition, then parses this file using `parse_python_file`. The test checks that the parsed signature matches the expected format, and verifies that the function&#x27;s docstring is correctly extracted and included in the parsed result.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_parse_complex_signature</span>(tmp_path: Path) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    src <span style="color: #666666">=</span> textwrap<span style="color: #666666">.</span>dedent(
<span style="color: #bbbbbb">        </span><span style="color: #BA2121; font-style: italic">&#39;&#39;&#39;</span>
<span style="color: #BA2121; font-style: italic">        &quot;&quot;&quot;Docstring.&quot;&quot;&quot;</span>

<span style="color: #BA2121; font-style: italic">        def complex(a, /, b, *, c: int = 1, **kw) -&gt; None:</span>
<span style="color: #BA2121; font-style: italic">            &quot;&quot;&quot;Complex function.&quot;&quot;&quot;</span>
<span style="color: #BA2121; font-style: italic">            pass</span>
<span style="color: #BA2121; font-style: italic">        &#39;&#39;&#39;</span>
    )
    file <span style="color: #666666">=</span> tmp_path <span style="color: #666666">/</span> <span style="color: #BA2121">&quot;sample.py&quot;</span>
    file<span style="color: #666666">.</span>write_text(src)

    result <span style="color: #666666">=</span> parse_python_file(<span style="color: #008000">str</span>(file))

    sig <span style="color: #666666">=</span> result[<span style="color: #BA2121">&quot;functions&quot;</span>][<span style="color: #666666">0</span>][<span style="color: #BA2121">&quot;signature&quot;</span>]
    func <span style="color: #666666">=</span> result[<span style="color: #BA2121">&quot;functions&quot;</span>][<span style="color: #666666">0</span>]
    <span style="color: #008000; font-weight: bold">assert</span> sig <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;complex(a/, b, *, c: int=1, **kw) -&gt; None&quot;</span>
    <span style="color: #008000; font-weight: bold">assert</span> func[<span style="color: #BA2121">&quot;docstring&quot;</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;Complex function.&quot;</span>
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #BA2121">&quot;Complex function.&quot;</span> <span style="color: #AA22FF; font-weight: bold">in</span> func[<span style="color: #BA2121">&quot;source&quot;</span>]
</code></pre>
<h3 id="test_parse_nested_structures">test_parse_nested_structures(tmp_path: Path) -&gt; None</h3>
<p>This function `test_parse_nested_structures` tests the ability to parse nested structures in Python source code. It creates a temporary file with nested functions and classes, then uses `parse_python_file` to analyze the file. The test verifies that the parsed result correctly identifies outer and inner functions, as well as nested subclasses and methods within those subclasses.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_parse_nested_structures</span>(tmp_path: Path) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    src <span style="color: #666666">=</span> textwrap<span style="color: #666666">.</span>dedent(
<span style="color: #bbbbbb">        </span><span style="color: #BA2121; font-style: italic">&#39;&#39;&#39;</span>
<span style="color: #BA2121; font-style: italic">        def outer(x):</span>
<span style="color: #BA2121; font-style: italic">            def inner(y):</span>
<span style="color: #BA2121; font-style: italic">                return y * 2</span>
<span style="color: #BA2121; font-style: italic">            return inner(x)</span>

<span style="color: #BA2121; font-style: italic">        class A:</span>
<span style="color: #BA2121; font-style: italic">            class B:</span>
<span style="color: #BA2121; font-style: italic">                def method(self):</span>
<span style="color: #BA2121; font-style: italic">                    pass</span>
<span style="color: #BA2121; font-style: italic">        &#39;&#39;&#39;</span>
    )
    file <span style="color: #666666">=</span> tmp_path <span style="color: #666666">/</span> <span style="color: #BA2121">&quot;sample.py&quot;</span>
    file<span style="color: #666666">.</span>write_text(src)

    result <span style="color: #666666">=</span> parse_python_file(<span style="color: #008000">str</span>(file))

    outer <span style="color: #666666">=</span> result[<span style="color: #BA2121">&quot;functions&quot;</span>][<span style="color: #666666">0</span>]
    <span style="color: #008000; font-weight: bold">assert</span> outer[<span style="color: #BA2121">&quot;name&quot;</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;outer&quot;</span>
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #008000">len</span>(outer<span style="color: #666666">.</span>get(<span style="color: #BA2121">&quot;subfunctions&quot;</span>, [])) <span style="color: #666666">==</span> <span style="color: #666666">1</span>
    <span style="color: #008000; font-weight: bold">assert</span> outer[<span style="color: #BA2121">&quot;subfunctions&quot;</span>][<span style="color: #666666">0</span>][<span style="color: #BA2121">&quot;name&quot;</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;inner&quot;</span>
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #BA2121">&quot;def inner&quot;</span> <span style="color: #AA22FF; font-weight: bold">in</span> outer[<span style="color: #BA2121">&quot;subfunctions&quot;</span>][<span style="color: #666666">0</span>][<span style="color: #BA2121">&quot;source&quot;</span>]

    <span style="color: #008000">cls</span> <span style="color: #666666">=</span> result[<span style="color: #BA2121">&quot;classes&quot;</span>][<span style="color: #666666">0</span>]
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #008000">cls</span>[<span style="color: #BA2121">&quot;name&quot;</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;A&quot;</span>
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #008000">len</span>(<span style="color: #008000">cls</span><span style="color: #666666">.</span>get(<span style="color: #BA2121">&quot;subclasses&quot;</span>, [])) <span style="color: #666666">==</span> <span style="color: #666666">1</span>
    sub <span style="color: #666666">=</span> <span style="color: #008000">cls</span>[<span style="color: #BA2121">&quot;subclasses&quot;</span>][<span style="color: #666666">0</span>]
    <span style="color: #008000; font-weight: bold">assert</span> sub[<span style="color: #BA2121">&quot;name&quot;</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;B&quot;</span>
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #008000">len</span>(sub<span style="color: #666666">.</span>get(<span style="color: #BA2121">&quot;methods&quot;</span>, [])) <span style="color: #666666">==</span> <span style="color: #666666">1</span>
    <span style="color: #008000; font-weight: bold">assert</span> sub[<span style="color: #BA2121">&quot;methods&quot;</span>][<span style="color: #666666">0</span>][<span style="color: #BA2121">&quot;name&quot;</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;method&quot;</span>
</code></pre>
<h3 id="test_deeply_nested_classes">test_deeply_nested_classes(tmp_path: Path) -&gt; None</h3>
<p>This function `test_deeply_nested_classes` tests the parsing of Python files containing deeply nested classes. It creates a temporary file with nested class definitions, parses it using `parse_python_file`, and then asserts that the nested classes and their methods are correctly identified in the parsed result. The test checks if the innermost class &quot;C&quot; and its method &quot;inner&quot; are present under the correct parent classes.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_deeply_nested_classes</span>(tmp_path: Path) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    src <span style="color: #666666">=</span> textwrap<span style="color: #666666">.</span>dedent(
<span style="color: #bbbbbb">        </span><span style="color: #BA2121; font-style: italic">&#39;&#39;&#39;</span>
<span style="color: #BA2121; font-style: italic">        class A:</span>
<span style="color: #BA2121; font-style: italic">            class B:</span>
<span style="color: #BA2121; font-style: italic">                class C:</span>
<span style="color: #BA2121; font-style: italic">                    def inner(self):</span>
<span style="color: #BA2121; font-style: italic">                        pass</span>
<span style="color: #BA2121; font-style: italic">        &#39;&#39;&#39;</span>
    )
    file <span style="color: #666666">=</span> tmp_path <span style="color: #666666">/</span> <span style="color: #BA2121">&quot;deep.py&quot;</span>
    file<span style="color: #666666">.</span>write_text(src)

    result <span style="color: #666666">=</span> parse_python_file(<span style="color: #008000">str</span>(file))

    a <span style="color: #666666">=</span> result[<span style="color: #BA2121">&quot;classes&quot;</span>][<span style="color: #666666">0</span>]
    b <span style="color: #666666">=</span> a[<span style="color: #BA2121">&quot;subclasses&quot;</span>][<span style="color: #666666">0</span>]
    c <span style="color: #666666">=</span> b[<span style="color: #BA2121">&quot;subclasses&quot;</span>][<span style="color: #666666">0</span>]
    <span style="color: #008000; font-weight: bold">assert</span> c[<span style="color: #BA2121">&quot;name&quot;</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;C&quot;</span>
    <span style="color: #008000; font-weight: bold">assert</span> c[<span style="color: #BA2121">&quot;methods&quot;</span>][<span style="color: #666666">0</span>][<span style="color: #BA2121">&quot;name&quot;</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;inner&quot;</span>
</code></pre>
<h3 id="test_class_inside_method">test_class_inside_method(tmp_path: Path) -&gt; None</h3>
<p>The function `test_class_inside_method` is designed to test the parsing of Python source files containing nested classes and methods. It uses a temporary directory provided by `tmp_path` to create a file named `inner.py`. The content of this file defines a class `A` with an outer method `outer`, which itself contains another class `B` with a method `m`.

The function then calls `parse_python_file` with the path to the created Python file. This function is assumed to parse the Python source code and return a dictionary representing the parsed structure.

After parsing, the function asserts that:
1. The first class in the result has one subclass.
2. The name of this subclass is &quot;B&quot;.
3. The subclass `B` contains one method named &quot;m&quot;.

This test ensures that the parser correctly identifies nested classes and methods within a Python file.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_class_inside_method</span>(tmp_path: Path) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    src <span style="color: #666666">=</span> textwrap<span style="color: #666666">.</span>dedent(
<span style="color: #bbbbbb">        </span><span style="color: #BA2121; font-style: italic">&#39;&#39;&#39;</span>
<span style="color: #BA2121; font-style: italic">        class A:</span>
<span style="color: #BA2121; font-style: italic">            def outer(self):</span>
<span style="color: #BA2121; font-style: italic">                class B:</span>
<span style="color: #BA2121; font-style: italic">                    def m(self):</span>
<span style="color: #BA2121; font-style: italic">                        pass</span>
<span style="color: #BA2121; font-style: italic">        &#39;&#39;&#39;</span>
    )
    file <span style="color: #666666">=</span> tmp_path <span style="color: #666666">/</span> <span style="color: #BA2121">&quot;inner.py&quot;</span>
    file<span style="color: #666666">.</span>write_text(src)

    result <span style="color: #666666">=</span> parse_python_file(<span style="color: #008000">str</span>(file))

    a <span style="color: #666666">=</span> result[<span style="color: #BA2121">&quot;classes&quot;</span>][<span style="color: #666666">0</span>]
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #008000">len</span>(a[<span style="color: #BA2121">&quot;subclasses&quot;</span>]) <span style="color: #666666">==</span> <span style="color: #666666">1</span>
    b <span style="color: #666666">=</span> a[<span style="color: #BA2121">&quot;subclasses&quot;</span>][<span style="color: #666666">0</span>]
    <span style="color: #008000; font-weight: bold">assert</span> b[<span style="color: #BA2121">&quot;name&quot;</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;B&quot;</span>
    <span style="color: #008000; font-weight: bold">assert</span> b[<span style="color: #BA2121">&quot;methods&quot;</span>][<span style="color: #666666">0</span>][<span style="color: #BA2121">&quot;name&quot;</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;m&quot;</span>
</code></pre>
    </div>
    <script src="static/toggle.js"></script>
</body>
</html>
