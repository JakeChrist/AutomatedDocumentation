<!-- Generated by DocGen-LM -->
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/><meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>test_retrofit_sidebar</title>
<link href="static/style.css" rel="stylesheet"/>
</head>
<body><a class="skip-link" href="#main-content">Skip to main content</a><header class="topbar"><button aria-label="Toggle navigation menu" id="sidebar-toggle">Menu</button><span class="topbar-title">test_retrofit_sidebar</span></header>
<nav aria-label="Documentation navigation" class="sidebar">
<h2>Navigation</h2>
<ul><li><a href="index.html"><strong>üè† Project Overview</strong></a></li><li><a href="cache.html">cache</a></li><li><a href="chunk_utils.html">chunk_utils</a></li><li><a href="docgenerator.html">docgenerator</a></li><li><a href="explaincode.html">explaincode</a></li><li><a href="gui_wrapper.html">gui_wrapper</a></li><li><a href="html_writer.html">html_writer</a></li><li><a href="llm_client.html">llm_client</a></li><li><a href="manual_utils.html">manual_utils</a></li><li><a href="parser_cpp.html">parser_cpp</a></li><li><a href="parser_java.html">parser_java</a></li><li><a href="parser_matlab.html">parser_matlab</a></li><li><a href="parser_python.html">parser_python</a></li><li><a href="retrofit_sidebar.html">retrofit_sidebar</a></li><li><a href="reviewer.html">reviewer</a></li><li><a href="sanitize_docs.html">sanitize_docs</a></li><li><a href="scanner.html">scanner</a></li><li><a href="setup.html">setup</a></li><li><a href="summarize_utils.html">summarize_utils</a></li><li><details><summary>tests</summary><ul><li><a href="test_cache.html">test_cache</a></li><li><a href="test_chunk_utils.html">test_chunk_utils</a></li><li><a href="test_docgenerator.html">test_docgenerator</a></li><li><a href="test_docgenerator_subclasses.html">test_docgenerator_subclasses</a></li><li><a href="test_explaincode.html">test_explaincode</a></li><li><a href="test_html_writer.html">test_html_writer</a></li><li><a href="test_integration.html">test_integration</a></li><li><a href="test_llm_client.html">test_llm_client</a></li><li><a href="test_manual_utils.html">test_manual_utils</a></li><li><a href="test_parser_cpp.html">test_parser_cpp</a></li><li><a href="test_parser_java.html">test_parser_java</a></li><li><a href="test_parser_matlab.html">test_parser_matlab</a></li><li><a href="test_parser_python.html">test_parser_python</a></li><li><a href="test_resume_progress.html">test_resume_progress</a></li><li><a href="test_retrofit_sidebar.html">test_retrofit_sidebar</a></li><li><a href="test_reviewer.html">test_reviewer</a></li><li><a href="test_sanitize_docs.html">test_sanitize_docs</a></li><li><a href="test_scanner.html">test_scanner</a></li></ul></details></li></ul>
</nav>
<main class="content" id="main-content" role="main">
<h1>test_retrofit_sidebar</h1>
<p>The module defines tests for the `retrofit_sidebar` function and its associated `main` function. The tests verify that `retrofit_sidebar` correctly updates HTML documentation files by inserting a sidebar with links to Python source files and their submodules. It checks that the sidebar structure is built properly, with correct file paths and names. The tests also confirm that `main` exits with an error code and reports appropriate errors when the source or documentation directories are missing.</p>
<h2>Functions</h2>
<h3 id="test_retrofit_sidebar">test_retrofit_sidebar(tmp_path: Path) -&gt; None</h3>
<p>The function `test_retrofit_sidebar` tests the `retrofit_sidebar` utility by creating a temporary directory structure with Python source files and an existing HTML documentation page. It verifies that the `retrofit_sidebar` function correctly updates the sidebar content in the HTML file with links to the Python modules and submodules, preserving the original main content. The test checks that module and package links are properly added to the sidebar's unordered list, ensuring correct navigation paths for the documented files.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_retrofit_sidebar</span>(tmp_path: Path) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    src <span style="color: #666666">=</span> tmp_path <span style="color: #666666">/</span> <span style="color: #BA2121">"src"</span>
    src<span style="color: #666666">.</span>mkdir()
    (src <span style="color: #666666">/</span> <span style="color: #BA2121">"module_a.py"</span>)<span style="color: #666666">.</span>write_text(<span style="color: #BA2121">"# sample</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">"</span>, encoding<span style="color: #666666">=</span><span style="color: #BA2121">"utf-8"</span>)
    pkg <span style="color: #666666">=</span> src <span style="color: #666666">/</span> <span style="color: #BA2121">"pkg"</span>
    pkg<span style="color: #666666">.</span>mkdir()
    (pkg <span style="color: #666666">/</span> <span style="color: #BA2121">"__init__.py"</span>)<span style="color: #666666">.</span>write_text(<span style="color: #BA2121">"# init</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">"</span>, encoding<span style="color: #666666">=</span><span style="color: #BA2121">"utf-8"</span>)
    (pkg <span style="color: #666666">/</span> <span style="color: #BA2121">"submodule.py"</span>)<span style="color: #666666">.</span>write_text(<span style="color: #BA2121">"# sub</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">"</span>, encoding<span style="color: #666666">=</span><span style="color: #BA2121">"utf-8"</span>)

    docs <span style="color: #666666">=</span> tmp_path <span style="color: #666666">/</span> <span style="color: #BA2121">"docs"</span>
    docs<span style="color: #666666">.</span>mkdir()
    html_path <span style="color: #666666">=</span> docs <span style="color: #666666">/</span> <span style="color: #BA2121">"page.html"</span>
    html_content <span style="color: #666666">=</span> (
        <span style="color: #BA2121">"&lt;html&gt;&lt;body&gt;&lt;div class='sidebar'&gt;&lt;p&gt;Old sidebar&lt;/p&gt;&lt;/div&gt;"</span>
        <span style="color: #BA2121">"&lt;div class='content'&gt;&lt;p&gt;Main content&lt;/p&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;"</span>
    )
    html_path<span style="color: #666666">.</span>write_text(html_content, encoding<span style="color: #666666">=</span><span style="color: #BA2121">"utf-8"</span>)
    original_main <span style="color: #666666">=</span> BeautifulSoup(html_content, <span style="color: #BA2121">"html.parser"</span>)<span style="color: #666666">.</span>find(
        <span style="color: #BA2121">"div"</span>, class_<span style="color: #666666">=</span><span style="color: #BA2121">"content"</span>
    )<span style="color: #666666">.</span>decode()

    retrofit_sidebar(<span style="color: #008000">str</span>(src), <span style="color: #008000">str</span>(docs))

    soup <span style="color: #666666">=</span> BeautifulSoup(html_path<span style="color: #666666">.</span>read_text(encoding<span style="color: #666666">=</span><span style="color: #BA2121">"utf-8"</span>), <span style="color: #BA2121">"html.parser"</span>)
    sidebar <span style="color: #666666">=</span> soup<span style="color: #666666">.</span>find(<span style="color: #BA2121">"div"</span>, class_<span style="color: #666666">=</span><span style="color: #BA2121">"sidebar"</span>)
    ul <span style="color: #666666">=</span> sidebar<span style="color: #666666">.</span>find(<span style="color: #BA2121">"ul"</span>, recursive<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">False</span>)
    top_items <span style="color: #666666">=</span> ul<span style="color: #666666">.</span>find_all(<span style="color: #BA2121">"li"</span>, recursive<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">False</span>)

    module_link <span style="color: #666666">=</span> top_items[<span style="color: #666666">0</span>]<span style="color: #666666">.</span>find(<span style="color: #BA2121">"a"</span>, recursive<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">False</span>)
    <span style="color: #008000; font-weight: bold">assert</span> module_link <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #AA22FF; font-weight: bold">not</span> <span style="color: #008000; font-weight: bold">None</span>
    <span style="color: #008000; font-weight: bold">assert</span> module_link[<span style="color: #BA2121">"href"</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">"module_a.html"</span>
    <span style="color: #008000; font-weight: bold">assert</span> module_link<span style="color: #666666">.</span>string <span style="color: #666666">==</span> <span style="color: #BA2121">"module_a.py"</span>

    pkg_li <span style="color: #666666">=</span> top_items[<span style="color: #666666">1</span>]
    <span style="color: #008000; font-weight: bold">assert</span> pkg_li<span style="color: #666666">.</span>contents[<span style="color: #666666">0</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">"pkg"</span>
    pkg_ul <span style="color: #666666">=</span> pkg_li<span style="color: #666666">.</span>find(<span style="color: #BA2121">"ul"</span>, recursive<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">False</span>)
    pkg_items <span style="color: #666666">=</span> pkg_ul<span style="color: #666666">.</span>find_all(<span style="color: #BA2121">"li"</span>, recursive<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">False</span>)
    pkg_links <span style="color: #666666">=</span> [li<span style="color: #666666">.</span>find(<span style="color: #BA2121">"a"</span>, recursive<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">False</span>) <span style="color: #008000; font-weight: bold">for</span> li <span style="color: #AA22FF; font-weight: bold">in</span> pkg_items]
    <span style="color: #008000; font-weight: bold">assert</span> [link<span style="color: #666666">.</span>string <span style="color: #008000; font-weight: bold">for</span> link <span style="color: #AA22FF; font-weight: bold">in</span> pkg_links] <span style="color: #666666">==</span> [<span style="color: #BA2121">"__init__.py"</span>, <span style="color: #BA2121">"submodule.py"</span>]
    <span style="color: #008000; font-weight: bold">assert</span> [link[<span style="color: #BA2121">"href"</span>] <span style="color: #008000; font-weight: bold">for</span> link <span style="color: #AA22FF; font-weight: bold">in</span> pkg_links] <span style="color: #666666">==</span> [
        <span style="color: #BA2121">"pkg/__init__.html"</span>,
        <span style="color: #BA2121">"pkg/submodule.html"</span>,
    ]

    <span style="color: #008000; font-weight: bold">assert</span> soup<span style="color: #666666">.</span>find(<span style="color: #BA2121">"div"</span>, class_<span style="color: #666666">=</span><span style="color: #BA2121">"content"</span>)<span style="color: #666666">.</span>decode() <span style="color: #666666">==</span> original_main
</code></pre>
<h3 id="test_main_missing_source">test_main_missing_source(tmp_path: Path, capsys, monkeypatch) -&gt; None</h3>
<p>The function `test_main_missing_source` tests the behavior of the `main` function when a specified source directory is missing. It creates a temporary path with a documentation directory and a missing source directory, sets the command-line arguments to point to these directories using `monkeypatch.setattr`, and asserts that `main()` returns `1` (indicating an error). It then captures the error output using `capsys.readouterr().err` and verifies that the error message contains the phrase "source directory".</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_main_missing_source</span>(tmp_path: Path, capsys, monkeypatch) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    docs <span style="color: #666666">=</span> tmp_path <span style="color: #666666">/</span> <span style="color: #BA2121">"docs"</span>
    docs<span style="color: #666666">.</span>mkdir()
    missing <span style="color: #666666">=</span> tmp_path <span style="color: #666666">/</span> <span style="color: #BA2121">"missing"</span>
    monkeypatch<span style="color: #666666">.</span>setattr(
        sys,
        <span style="color: #BA2121">"argv"</span>,
        [
            <span style="color: #BA2121">"retrofit_sidebar"</span>,
            <span style="color: #BA2121">"--source"</span>,
            <span style="color: #008000">str</span>(missing),
            <span style="color: #BA2121">"--docs"</span>,
            <span style="color: #008000">str</span>(docs),
        ],
    )
    <span style="color: #008000; font-weight: bold">assert</span> main() <span style="color: #666666">==</span> <span style="color: #666666">1</span>
    err <span style="color: #666666">=</span> capsys<span style="color: #666666">.</span>readouterr()<span style="color: #666666">.</span>err
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #BA2121">"source directory"</span> <span style="color: #AA22FF; font-weight: bold">in</span> err
</code></pre>
<h3 id="test_main_missing_docs">test_main_missing_docs(tmp_path: Path, capsys, monkeypatch) -&gt; None</h3>
<p>The function `test_main_missing_docs` tests the behavior of the `main` function when required documentation directories are missing. It creates a temporary source directory, sets up command-line arguments to point to non-existent documentation and source paths using `monkeypatch.setattr`, and asserts that `main()` returns 1 (indicating an error). It also captures stderr output and verifies that the error message contains "docs directory".</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_main_missing_docs</span>(tmp_path: Path, capsys, monkeypatch) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    src <span style="color: #666666">=</span> tmp_path <span style="color: #666666">/</span> <span style="color: #BA2121">"src"</span>
    src<span style="color: #666666">.</span>mkdir()
    missing <span style="color: #666666">=</span> tmp_path <span style="color: #666666">/</span> <span style="color: #BA2121">"missing"</span>
    monkeypatch<span style="color: #666666">.</span>setattr(
        sys,
        <span style="color: #BA2121">"argv"</span>,
        [
            <span style="color: #BA2121">"retrofit_sidebar"</span>,
            <span style="color: #BA2121">"--source"</span>,
            <span style="color: #008000">str</span>(src),
            <span style="color: #BA2121">"--docs"</span>,
            <span style="color: #008000">str</span>(missing),
        ],
    )
    <span style="color: #008000; font-weight: bold">assert</span> main() <span style="color: #666666">==</span> <span style="color: #666666">1</span>
    err <span style="color: #666666">=</span> capsys<span style="color: #666666">.</span>readouterr()<span style="color: #666666">.</span>err
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #BA2121">"docs directory"</span> <span style="color: #AA22FF; font-weight: bold">in</span> err
</code></pre>
</main>
<footer aria-label="Page footer" class="page-footer"><p>Generated documentation</p></footer><script src="static/toggle.js"></script>
</body>
</html>
