<!-- Generated by DocGen-LM -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>test_retrofit_sidebar</title>
    <link rel="stylesheet" href="static/style.css">
</head>
<body>
    <button id="sidebar-toggle">Menu</button>
    <div class="sidebar">
        <h2>Navigation</h2>
        <ul><li><a href="index.html"><strong>üè† Project Overview</strong></a></li><li><a href="cache.html">cache</a></li><li><a href="chunk_utils.html">chunk_utils</a></li><li><a href="docgenerator.html">docgenerator</a></li><li><a href="explaincode.html">explaincode</a></li><li><a href="gui_wrapper.html">gui_wrapper</a></li><li><a href="html_writer.html">html_writer</a></li><li><a href="llm_client.html">llm_client</a></li><li><a href="manual_utils.html">manual_utils</a></li><li><a href="parser_cpp.html">parser_cpp</a></li><li><a href="parser_java.html">parser_java</a></li><li><a href="parser_matlab.html">parser_matlab</a></li><li><a href="parser_python.html">parser_python</a></li><li><a href="retrofit_sidebar.html">retrofit_sidebar</a></li><li><a href="reviewer.html">reviewer</a></li><li><a href="sanitize_docs.html">sanitize_docs</a></li><li><a href="scanner.html">scanner</a></li><li><a href="setup.html">setup</a></li><li><a href="summarize_utils.html">summarize_utils</a></li><li><details><summary>tests</summary><ul><li><a href="test_cache.html">test_cache</a></li><li><a href="test_chunk_utils.html">test_chunk_utils</a></li><li><a href="test_docgenerator.html">test_docgenerator</a></li><li><a href="test_docgenerator_subclasses.html">test_docgenerator_subclasses</a></li><li><a href="test_explaincode.html">test_explaincode</a></li><li><a href="test_html_writer.html">test_html_writer</a></li><li><a href="test_integration.html">test_integration</a></li><li><a href="test_llm_client.html">test_llm_client</a></li><li><a href="test_manual_utils.html">test_manual_utils</a></li><li><a href="test_parser_cpp.html">test_parser_cpp</a></li><li><a href="test_parser_java.html">test_parser_java</a></li><li><a href="test_parser_matlab.html">test_parser_matlab</a></li><li><a href="test_parser_python.html">test_parser_python</a></li><li><a href="test_resume_progress.html">test_resume_progress</a></li><li><a href="test_retrofit_sidebar.html">test_retrofit_sidebar</a></li><li><a href="test_reviewer.html">test_reviewer</a></li><li><a href="test_sanitize_docs.html">test_sanitize_docs</a></li><li><a href="test_scanner.html">test_scanner</a></li></ul></details></li></ul>
    </div>
    <div class="content">
        <h1>test_retrofit_sidebar</h1>
        <p>Module defines tests for `retrofit_sidebar` function and its command-line interface. Tests validate sidebar generation from Python source files, checking link creation for modules and submodules. Includes test cases for missing source or documentation directories, verifying error handling and exit codes. Uses `BeautifulSoup` for HTML parsing and manipulation.</p>
<h2>Functions</h2>
<h3 id="test_retrofit_sidebar">test_retrofit_sidebar(tmp_path: Path) -&gt; None</h3>
<p>The function `test_retrofit_sidebar` tests the functionality of retrofitting a sidebar into an existing HTML documentation page. It creates a temporary directory structure with Python source files, writes an initial HTML document with a sidebar and content section, then calls `retrofit_sidebar` to update the sidebar with links to the source files. The test verifies that the updated sidebar contains correct hierarchical links for modules and submodules, and ensures the original content remains unchanged.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_retrofit_sidebar</span>(tmp_path: Path) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    src <span style="color: #666666">=</span> tmp_path <span style="color: #666666">/</span> <span style="color: #BA2121">&quot;src&quot;</span>
    src<span style="color: #666666">.</span>mkdir()
    (src <span style="color: #666666">/</span> <span style="color: #BA2121">&quot;module_a.py&quot;</span>)<span style="color: #666666">.</span>write_text(<span style="color: #BA2121">&quot;# sample</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">&quot;</span>, encoding<span style="color: #666666">=</span><span style="color: #BA2121">&quot;utf-8&quot;</span>)
    pkg <span style="color: #666666">=</span> src <span style="color: #666666">/</span> <span style="color: #BA2121">&quot;pkg&quot;</span>
    pkg<span style="color: #666666">.</span>mkdir()
    (pkg <span style="color: #666666">/</span> <span style="color: #BA2121">&quot;__init__.py&quot;</span>)<span style="color: #666666">.</span>write_text(<span style="color: #BA2121">&quot;# init</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">&quot;</span>, encoding<span style="color: #666666">=</span><span style="color: #BA2121">&quot;utf-8&quot;</span>)
    (pkg <span style="color: #666666">/</span> <span style="color: #BA2121">&quot;submodule.py&quot;</span>)<span style="color: #666666">.</span>write_text(<span style="color: #BA2121">&quot;# sub</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">&quot;</span>, encoding<span style="color: #666666">=</span><span style="color: #BA2121">&quot;utf-8&quot;</span>)

    docs <span style="color: #666666">=</span> tmp_path <span style="color: #666666">/</span> <span style="color: #BA2121">&quot;docs&quot;</span>
    docs<span style="color: #666666">.</span>mkdir()
    html_path <span style="color: #666666">=</span> docs <span style="color: #666666">/</span> <span style="color: #BA2121">&quot;page.html&quot;</span>
    html_content <span style="color: #666666">=</span> (
        <span style="color: #BA2121">&quot;&lt;html&gt;&lt;body&gt;&lt;div class=&#39;sidebar&#39;&gt;&lt;p&gt;Old sidebar&lt;/p&gt;&lt;/div&gt;&quot;</span>
        <span style="color: #BA2121">&quot;&lt;div class=&#39;content&#39;&gt;&lt;p&gt;Main content&lt;/p&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span>
    )
    html_path<span style="color: #666666">.</span>write_text(html_content, encoding<span style="color: #666666">=</span><span style="color: #BA2121">&quot;utf-8&quot;</span>)
    original_main <span style="color: #666666">=</span> BeautifulSoup(html_content, <span style="color: #BA2121">&quot;html.parser&quot;</span>)<span style="color: #666666">.</span>find(
        <span style="color: #BA2121">&quot;div&quot;</span>, class_<span style="color: #666666">=</span><span style="color: #BA2121">&quot;content&quot;</span>
    )<span style="color: #666666">.</span>decode()

    retrofit_sidebar(<span style="color: #008000">str</span>(src), <span style="color: #008000">str</span>(docs))

    soup <span style="color: #666666">=</span> BeautifulSoup(html_path<span style="color: #666666">.</span>read_text(encoding<span style="color: #666666">=</span><span style="color: #BA2121">&quot;utf-8&quot;</span>), <span style="color: #BA2121">&quot;html.parser&quot;</span>)
    sidebar <span style="color: #666666">=</span> soup<span style="color: #666666">.</span>find(<span style="color: #BA2121">&quot;div&quot;</span>, class_<span style="color: #666666">=</span><span style="color: #BA2121">&quot;sidebar&quot;</span>)
    ul <span style="color: #666666">=</span> sidebar<span style="color: #666666">.</span>find(<span style="color: #BA2121">&quot;ul&quot;</span>, recursive<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">False</span>)
    top_items <span style="color: #666666">=</span> ul<span style="color: #666666">.</span>find_all(<span style="color: #BA2121">&quot;li&quot;</span>, recursive<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">False</span>)

    module_link <span style="color: #666666">=</span> top_items[<span style="color: #666666">0</span>]<span style="color: #666666">.</span>find(<span style="color: #BA2121">&quot;a&quot;</span>, recursive<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">False</span>)
    <span style="color: #008000; font-weight: bold">assert</span> module_link <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #AA22FF; font-weight: bold">not</span> <span style="color: #008000; font-weight: bold">None</span>
    <span style="color: #008000; font-weight: bold">assert</span> module_link[<span style="color: #BA2121">&quot;href&quot;</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;module_a.html&quot;</span>
    <span style="color: #008000; font-weight: bold">assert</span> module_link<span style="color: #666666">.</span>string <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;module_a.py&quot;</span>

    pkg_li <span style="color: #666666">=</span> top_items[<span style="color: #666666">1</span>]
    <span style="color: #008000; font-weight: bold">assert</span> pkg_li<span style="color: #666666">.</span>contents[<span style="color: #666666">0</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;pkg&quot;</span>
    pkg_ul <span style="color: #666666">=</span> pkg_li<span style="color: #666666">.</span>find(<span style="color: #BA2121">&quot;ul&quot;</span>, recursive<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">False</span>)
    pkg_items <span style="color: #666666">=</span> pkg_ul<span style="color: #666666">.</span>find_all(<span style="color: #BA2121">&quot;li&quot;</span>, recursive<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">False</span>)
    pkg_links <span style="color: #666666">=</span> [li<span style="color: #666666">.</span>find(<span style="color: #BA2121">&quot;a&quot;</span>, recursive<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">False</span>) <span style="color: #008000; font-weight: bold">for</span> li <span style="color: #AA22FF; font-weight: bold">in</span> pkg_items]
    <span style="color: #008000; font-weight: bold">assert</span> [link<span style="color: #666666">.</span>string <span style="color: #008000; font-weight: bold">for</span> link <span style="color: #AA22FF; font-weight: bold">in</span> pkg_links] <span style="color: #666666">==</span> [<span style="color: #BA2121">&quot;__init__.py&quot;</span>, <span style="color: #BA2121">&quot;submodule.py&quot;</span>]
    <span style="color: #008000; font-weight: bold">assert</span> [link[<span style="color: #BA2121">&quot;href&quot;</span>] <span style="color: #008000; font-weight: bold">for</span> link <span style="color: #AA22FF; font-weight: bold">in</span> pkg_links] <span style="color: #666666">==</span> [
        <span style="color: #BA2121">&quot;pkg/__init__.html&quot;</span>,
        <span style="color: #BA2121">&quot;pkg/submodule.html&quot;</span>,
    ]

    <span style="color: #008000; font-weight: bold">assert</span> soup<span style="color: #666666">.</span>find(<span style="color: #BA2121">&quot;div&quot;</span>, class_<span style="color: #666666">=</span><span style="color: #BA2121">&quot;content&quot;</span>)<span style="color: #666666">.</span>decode() <span style="color: #666666">==</span> original_main
</code></pre>
<h3 id="test_main_missing_source">test_main_missing_source(tmp_path: Path, capsys, monkeypatch) -&gt; None</h3>
<p>The function `test_main_missing_source` tests the behavior of the `main` function when a specified source directory is missing. It creates a temporary directory structure, sets up command-line arguments to point to a non-existent source directory using `monkeypatch.setattr`, and asserts that the `main` function returns 1 (indicating an error). It also captures the error output and verifies that it contains the message &quot;source directory&quot;.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_main_missing_source</span>(tmp_path: Path, capsys, monkeypatch) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    docs <span style="color: #666666">=</span> tmp_path <span style="color: #666666">/</span> <span style="color: #BA2121">&quot;docs&quot;</span>
    docs<span style="color: #666666">.</span>mkdir()
    missing <span style="color: #666666">=</span> tmp_path <span style="color: #666666">/</span> <span style="color: #BA2121">&quot;missing&quot;</span>
    monkeypatch<span style="color: #666666">.</span>setattr(
        sys,
        <span style="color: #BA2121">&quot;argv&quot;</span>,
        [
            <span style="color: #BA2121">&quot;retrofit_sidebar&quot;</span>,
            <span style="color: #BA2121">&quot;--source&quot;</span>,
            <span style="color: #008000">str</span>(missing),
            <span style="color: #BA2121">&quot;--docs&quot;</span>,
            <span style="color: #008000">str</span>(docs),
        ],
    )
    <span style="color: #008000; font-weight: bold">assert</span> main() <span style="color: #666666">==</span> <span style="color: #666666">1</span>
    err <span style="color: #666666">=</span> capsys<span style="color: #666666">.</span>readouterr()<span style="color: #666666">.</span>err
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #BA2121">&quot;source directory&quot;</span> <span style="color: #AA22FF; font-weight: bold">in</span> err
</code></pre>
<h3 id="test_main_missing_docs">test_main_missing_docs(tmp_path: Path, capsys, monkeypatch) -&gt; None</h3>
<p>This function tests the behavior of the `main` function when required documentation directories are missing. It creates a temporary source directory, sets up command-line arguments to point to non-existent documentation and source paths using `monkeypatch`, and verifies that the `main` function returns an error code (1) and outputs an error message indicating that the documentation directory is missing. The test uses `capsys` to capture standard error output for validation.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_main_missing_docs</span>(tmp_path: Path, capsys, monkeypatch) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    src <span style="color: #666666">=</span> tmp_path <span style="color: #666666">/</span> <span style="color: #BA2121">&quot;src&quot;</span>
    src<span style="color: #666666">.</span>mkdir()
    missing <span style="color: #666666">=</span> tmp_path <span style="color: #666666">/</span> <span style="color: #BA2121">&quot;missing&quot;</span>
    monkeypatch<span style="color: #666666">.</span>setattr(
        sys,
        <span style="color: #BA2121">&quot;argv&quot;</span>,
        [
            <span style="color: #BA2121">&quot;retrofit_sidebar&quot;</span>,
            <span style="color: #BA2121">&quot;--source&quot;</span>,
            <span style="color: #008000">str</span>(src),
            <span style="color: #BA2121">&quot;--docs&quot;</span>,
            <span style="color: #008000">str</span>(missing),
        ],
    )
    <span style="color: #008000; font-weight: bold">assert</span> main() <span style="color: #666666">==</span> <span style="color: #666666">1</span>
    err <span style="color: #666666">=</span> capsys<span style="color: #666666">.</span>readouterr()<span style="color: #666666">.</span>err
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #BA2121">&quot;docs directory&quot;</span> <span style="color: #AA22FF; font-weight: bold">in</span> err
</code></pre>
    </div>
    <script src="static/toggle.js"></script>
</body>
</html>
