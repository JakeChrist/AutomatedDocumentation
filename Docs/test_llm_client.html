<!-- Generated by DocGen-LM -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>test_llm_client</title>
    <link rel="stylesheet" href="static/style.css">
</head>
<body>
    <button id="sidebar-toggle">Menu</button>
    <div class="sidebar">
        <h2>Navigation</h2>
        <ul>
        <li><a href="index.html"><strong>üè† Project Overview</strong></a></li>
<li><a href="cache.html">cache</a></li>
<li><a href="chunk_utils.html">chunk_utils</a></li>
<li><a href="docgenerator.html">docgenerator</a></li>
<li><a href="explaincode.html">explaincode</a></li>
<li><a href="gui_wrapper.html">gui_wrapper</a></li>
<li><a href="html_writer.html">html_writer</a></li>
<li><a href="llm_client.html">llm_client</a></li>
<li><a href="manual_utils.html">manual_utils</a></li>
<li><a href="parser_cpp.html">parser_cpp</a></li>
<li><a href="parser_java.html">parser_java</a></li>
<li><a href="parser_matlab.html">parser_matlab</a></li>
<li><a href="parser_python.html">parser_python</a></li>
<li><a href="reviewer.html">reviewer</a></li>
<li><a href="scanner.html">scanner</a></li>
<li><a href="setup.html">setup</a></li>
<li><a href="summarize_utils.html">summarize_utils</a></li>
<li><a href="test_cache.html">test_cache</a></li>
<li><a href="test_chunk_utils.html">test_chunk_utils</a></li>
<li><a href="test_docgenerator.html">test_docgenerator</a></li>
<li><a href="test_docgenerator_subclasses.html">test_docgenerator_subclasses</a></li>
<li><a href="test_explaincode.html">test_explaincode</a></li>
<li><a href="test_html_writer.html">test_html_writer</a></li>
<li><a href="test_integration.html">test_integration</a></li>
<li><a href="test_llm_client.html">test_llm_client</a></li>
<li><a href="test_manual_utils.html">test_manual_utils</a></li>
<li><a href="test_parser_cpp.html">test_parser_cpp</a></li>
<li><a href="test_parser_java.html">test_parser_java</a></li>
<li><a href="test_parser_matlab.html">test_parser_matlab</a></li>
<li><a href="test_parser_python.html">test_parser_python</a></li>
<li><a href="test_reviewer.html">test_reviewer</a></li>
<li><a href="test_scanner.html">test_scanner</a></li>
        </ul>
    </div>
    <div class="content">
        <h1>test_llm_client</h1>
        <p>The module defines unit tests for an `LLMClient` class. It includes tests for the `ping` method, which checks if the client can successfully connect to a server, and the `summarize` method, which sends text to a language model for summarization. The `sanitize_summary` function filters out disclaimers from the summary text. Each test uses mock objects to simulate HTTP requests and responses, and assertions to verify that the methods behave as expected under different conditions.</p>
<h2>Functions</h2>
<h3 id="test_ping_success">test_ping_success() -&gt; None</h3>
<p>This function tests the `ping` method of an `LLMClient` class. It creates a mock response object that simulates a successful HTTP GET request without raising any exceptions. The function then asserts that calling `client.ping()` returns `True`, indicating a successful connection. It also verifies that the `requests.get` method was called once with the specified URL and timeout, and that the `raise_for_status` method of the mock response object was called to ensure there were no HTTP errors.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_ping_success</span>() <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    client <span style="color: #666666">=</span> LLMClient(<span style="color: #BA2121">&quot;http://fake&quot;</span>)
    mock_response <span style="color: #666666">=</span> Mock()
    mock_response<span style="color: #666666">.</span>raise_for_status <span style="color: #666666">=</span> Mock()
    <span style="color: #008000; font-weight: bold">with</span> patch(<span style="color: #BA2121">&quot;requests.get&quot;</span>, return_value<span style="color: #666666">=</span>mock_response) <span style="color: #008000; font-weight: bold">as</span> get:
        <span style="color: #008000; font-weight: bold">assert</span> client<span style="color: #666666">.</span>ping() <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #008000; font-weight: bold">True</span>
        get<span style="color: #666666">.</span>assert_called_once_with(<span style="color: #BA2121">&quot;http://fake&quot;</span>, timeout<span style="color: #666666">=2.0</span>)
        mock_response<span style="color: #666666">.</span>raise_for_status<span style="color: #666666">.</span>assert_called_once()
</code></pre>
<h3 id="test_ping_failure">test_ping_failure() -&gt; None</h3>
<p>This function tests the `ping` method of an `LLMClient` class. It uses a mock to simulate a request failure when attempting to connect to &quot;http://fake&quot;. The test asserts that a `ConnectionError` is raised as expected when the ping operation fails due to the simulated network error.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_ping_failure</span>() <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    client <span style="color: #666666">=</span> LLMClient(<span style="color: #BA2121">&quot;http://fake&quot;</span>)
    <span style="color: #008000; font-weight: bold">with</span> patch(<span style="color: #BA2121">&quot;requests.get&quot;</span>, side_effect<span style="color: #666666">=</span>requests<span style="color: #666666">.</span>exceptions<span style="color: #666666">.</span>RequestException(<span style="color: #BA2121">&quot;fail&quot;</span>)):
        <span style="color: #008000; font-weight: bold">with</span> pytest<span style="color: #666666">.</span>raises(<span style="color: #CB3F38; font-weight: bold">ConnectionError</span>):
            client<span style="color: #666666">.</span>ping()
</code></pre>
<h3 id="test_summarize_retries_and_returns_summary">test_summarize_retries_and_returns_summary() -&gt; None</h3>
<p>The function `test_summarize_retries_and_returns_summary` tests the `summarize` method of an `LLMClient` class. It sets up a mock LLM client and response to simulate a request failure followed by a successful response. The test asserts that the `summarize` method retries on failure, waits for 1 second between attempts, and returns the expected summary text.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_summarize_retries_and_returns_summary</span>() <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    client <span style="color: #666666">=</span> LLMClient(<span style="color: #BA2121">&quot;http://fake&quot;</span>)
    mock_response <span style="color: #666666">=</span> Mock()
    mock_response<span style="color: #666666">.</span>raise_for_status <span style="color: #666666">=</span> Mock()
    mock_response<span style="color: #666666">.</span>json<span style="color: #666666">.</span>return_value <span style="color: #666666">=</span> {
        <span style="color: #BA2121">&quot;choices&quot;</span>: [
            {<span style="color: #BA2121">&quot;message&quot;</span>: {<span style="color: #BA2121">&quot;content&quot;</span>: <span style="color: #BA2121">&quot;You can run this.</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">Defines a class.&quot;</span>}}
        ]
    }
    <span style="color: #008000; font-weight: bold">with</span> patch(<span style="color: #BA2121">&quot;llm_client.requests.post&quot;</span>) <span style="color: #008000; font-weight: bold">as</span> post, patch(<span style="color: #BA2121">&quot;llm_client.time.sleep&quot;</span>) <span style="color: #008000; font-weight: bold">as</span> sleep:
        post<span style="color: #666666">.</span>side_effect <span style="color: #666666">=</span> [requests<span style="color: #666666">.</span>exceptions<span style="color: #666666">.</span>RequestException(<span style="color: #BA2121">&quot;boom&quot;</span>), mock_response]
        result <span style="color: #666666">=</span> client<span style="color: #666666">.</span>summarize(<span style="color: #BA2121">&quot;text&quot;</span>, <span style="color: #BA2121">&quot;module&quot;</span>)
        <span style="color: #008000; font-weight: bold">assert</span> result <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;Defines a class.&quot;</span>
        <span style="color: #008000; font-weight: bold">assert</span> post<span style="color: #666666">.</span>call_count <span style="color: #666666">==</span> <span style="color: #666666">2</span>
        sleep<span style="color: #666666">.</span>assert_called_once_with(<span style="color: #666666">1</span>)
        sent_prompt <span style="color: #666666">=</span> post<span style="color: #666666">.</span>call_args_list[<span style="color: #666666">1</span>][<span style="color: #666666">1</span>][<span style="color: #BA2121">&quot;json&quot;</span>][<span style="color: #BA2121">&quot;messages&quot;</span>][<span style="color: #666666">1</span>][<span style="color: #BA2121">&quot;content&quot;</span>]
        <span style="color: #008000; font-weight: bold">assert</span> sent_prompt <span style="color: #666666">==</span> PROMPT_TEMPLATES[<span style="color: #BA2121">&quot;module&quot;</span>]<span style="color: #666666">.</span>format(text<span style="color: #666666">=</span><span style="color: #BA2121">&quot;text&quot;</span>)
</code></pre>
<h3 id="test_summarize_raises_runtime_error_with_message">test_summarize_raises_runtime_error_with_message() -&gt; None</h3>
<p>This function tests that the `summarize` method of an `LLMClient` class raises a `RuntimeError` with a specific message when an HTTP error occurs during text generation. It uses mocking to simulate a failed HTTP request and a JSON parsing error, then asserts that the expected exception is raised with the correct message.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_summarize_raises_runtime_error_with_message</span>() <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    client <span style="color: #666666">=</span> LLMClient(<span style="color: #BA2121">&quot;http://fake&quot;</span>)
    mock_response <span style="color: #666666">=</span> Mock()
    mock_response<span style="color: #666666">.</span>raise_for_status<span style="color: #666666">.</span>side_effect <span style="color: #666666">=</span> requests<span style="color: #666666">.</span>exceptions<span style="color: #666666">.</span>HTTPError(response<span style="color: #666666">=</span>mock_response)
    mock_response<span style="color: #666666">.</span>json<span style="color: #666666">.</span>side_effect <span style="color: #666666">=</span> <span style="color: #CB3F38; font-weight: bold">ValueError</span>()
    mock_response<span style="color: #666666">.</span>text <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;server exploded&quot;</span>
    <span style="color: #008000; font-weight: bold">with</span> patch(<span style="color: #BA2121">&quot;llm_client.requests.post&quot;</span>, return_value<span style="color: #666666">=</span>mock_response), patch(<span style="color: #BA2121">&quot;llm_client.time.sleep&quot;</span>):
        <span style="color: #008000; font-weight: bold">with</span> pytest<span style="color: #666666">.</span>raises(<span style="color: #CB3F38; font-weight: bold">RuntimeError</span>, match<span style="color: #666666">=</span><span style="color: #BA2121">&quot;server exploded&quot;</span>):
            client<span style="color: #666666">.</span>summarize(<span style="color: #BA2121">&quot;text&quot;</span>, <span style="color: #BA2121">&quot;module&quot;</span>)
</code></pre>
<h3 id="test_sanitize_summary_filters_phrases">test_sanitize_summary_filters_phrases() -&gt; None</h3>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_sanitize_summary_filters_phrases</span>() <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    text <span style="color: #666666">=</span> (
        <span style="color: #BA2121">&quot;You can run this.</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">&quot;</span>
        <span style="color: #BA2121">&quot;Note that it is simple.</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">&quot;</span>
        <span style="color: #BA2121">&quot;Defines a class.</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">&quot;</span>
        <span style="color: #BA2121">&quot;This summary does not include disclaimers.</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">&quot;</span>
        <span style="color: #BA2121">&quot;This script does nothing.</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">&quot;</span>
        <span style="color: #BA2121">&quot;It prints output.&quot;</span>
    )
    <span style="color: #008000; font-weight: bold">assert</span> sanitize_summary(text) <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;Defines a class.</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">It prints output.&quot;</span>
</code></pre>
<h3 id="test_prompt_varies_by_type">test_prompt_varies_by_type() -&gt; None</h3>
<p>This function tests the `summarize` method of an `LLMClient` class, ensuring that it generates different prompts based on the type of code being summarized. It uses a mock HTTP client to simulate responses from a language model and compares the generated prompts for classes and functions. The test asserts that the prompts are correctly formatted using predefined templates and that they differ between class and function types.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_prompt_varies_by_type</span>() <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    client <span style="color: #666666">=</span> LLMClient(<span style="color: #BA2121">&quot;http://fake&quot;</span>)
    mock_response <span style="color: #666666">=</span> Mock()
    mock_response<span style="color: #666666">.</span>raise_for_status <span style="color: #666666">=</span> Mock()
    mock_response<span style="color: #666666">.</span>json<span style="color: #666666">.</span>return_value <span style="color: #666666">=</span> {<span style="color: #BA2121">&quot;choices&quot;</span>: [{<span style="color: #BA2121">&quot;message&quot;</span>: {<span style="color: #BA2121">&quot;content&quot;</span>: <span style="color: #BA2121">&quot;x&quot;</span>}}]}

    <span style="color: #008000; font-weight: bold">with</span> patch(<span style="color: #BA2121">&quot;llm_client.requests.post&quot;</span>, return_value<span style="color: #666666">=</span>mock_response) <span style="color: #008000; font-weight: bold">as</span> post:
        client<span style="color: #666666">.</span>summarize(<span style="color: #BA2121">&quot;foo&quot;</span>, <span style="color: #BA2121">&quot;class&quot;</span>)
        class_prompt <span style="color: #666666">=</span> post<span style="color: #666666">.</span>call_args[<span style="color: #666666">1</span>][<span style="color: #BA2121">&quot;json&quot;</span>][<span style="color: #BA2121">&quot;messages&quot;</span>][<span style="color: #666666">1</span>][<span style="color: #BA2121">&quot;content&quot;</span>]

    <span style="color: #008000; font-weight: bold">with</span> patch(<span style="color: #BA2121">&quot;llm_client.requests.post&quot;</span>, return_value<span style="color: #666666">=</span>mock_response) <span style="color: #008000; font-weight: bold">as</span> post:
        client<span style="color: #666666">.</span>summarize(<span style="color: #BA2121">&quot;foo&quot;</span>, <span style="color: #BA2121">&quot;function&quot;</span>)
        func_prompt <span style="color: #666666">=</span> post<span style="color: #666666">.</span>call_args[<span style="color: #666666">1</span>][<span style="color: #BA2121">&quot;json&quot;</span>][<span style="color: #BA2121">&quot;messages&quot;</span>][<span style="color: #666666">1</span>][<span style="color: #BA2121">&quot;content&quot;</span>]

    <span style="color: #008000; font-weight: bold">assert</span> class_prompt <span style="color: #666666">==</span> PROMPT_TEMPLATES[<span style="color: #BA2121">&quot;class&quot;</span>]<span style="color: #666666">.</span>format(text<span style="color: #666666">=</span><span style="color: #BA2121">&quot;foo&quot;</span>)
    <span style="color: #008000; font-weight: bold">assert</span> func_prompt <span style="color: #666666">==</span> PROMPT_TEMPLATES[<span style="color: #BA2121">&quot;function&quot;</span>]<span style="color: #666666">.</span>format(text<span style="color: #666666">=</span><span style="color: #BA2121">&quot;foo&quot;</span>)
    <span style="color: #008000; font-weight: bold">assert</span> class_prompt <span style="color: #666666">!=</span> func_prompt
</code></pre>
<h3 id="test_readme_prompt_template_used">test_readme_prompt_template_used() -&gt; None</h3>
<p>This function tests whether the `LLMClient` uses the correct prompt template for summarizing README files. It creates a mock response from an LLM client, simulates a POST request to the client with a sample text, and checks if the generated prompt matches the expected format using the `PROMPT_TEMPLATES[&quot;readme&quot;]`.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_readme_prompt_template_used</span>() <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    client <span style="color: #666666">=</span> LLMClient(<span style="color: #BA2121">&quot;http://fake&quot;</span>)
    mock_response <span style="color: #666666">=</span> Mock()
    mock_response<span style="color: #666666">.</span>raise_for_status <span style="color: #666666">=</span> Mock()
    mock_response<span style="color: #666666">.</span>json<span style="color: #666666">.</span>return_value <span style="color: #666666">=</span> {<span style="color: #BA2121">&quot;choices&quot;</span>: [{<span style="color: #BA2121">&quot;message&quot;</span>: {<span style="color: #BA2121">&quot;content&quot;</span>: <span style="color: #BA2121">&quot;x&quot;</span>}}]}

    <span style="color: #008000; font-weight: bold">with</span> patch(<span style="color: #BA2121">&quot;llm_client.requests.post&quot;</span>, return_value<span style="color: #666666">=</span>mock_response) <span style="color: #008000; font-weight: bold">as</span> post:
        client<span style="color: #666666">.</span>summarize(<span style="color: #BA2121">&quot;foo&quot;</span>, <span style="color: #BA2121">&quot;readme&quot;</span>)
        readme_prompt <span style="color: #666666">=</span> post<span style="color: #666666">.</span>call_args[<span style="color: #666666">1</span>][<span style="color: #BA2121">&quot;json&quot;</span>][<span style="color: #BA2121">&quot;messages&quot;</span>][<span style="color: #666666">1</span>][<span style="color: #BA2121">&quot;content&quot;</span>]

    <span style="color: #008000; font-weight: bold">assert</span> readme_prompt <span style="color: #666666">==</span> PROMPT_TEMPLATES[<span style="color: #BA2121">&quot;readme&quot;</span>]<span style="color: #666666">.</span>format(text<span style="color: #666666">=</span><span style="color: #BA2121">&quot;foo&quot;</span>)
</code></pre>
    </div>
    <script src="static/toggle.js"></script>
</body>
</html>
