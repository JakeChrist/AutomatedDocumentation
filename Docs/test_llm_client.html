<!-- Generated by DocGen-LM -->
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/><meta content="width=device-width, initial-scale=1" name="viewport"/>
    
<title>test_llm_client</title>
<link href="static/style.css" rel="stylesheet"/>
</head>
<body class="doc-body">
<button aria-label="Toggle navigation menu" class="sidebar-toggle" id="sidebar-toggle">Menu</button>
<div aria-label="Documentation navigation" class="sidebar" role="navigation">
<h2>Navigation</h2>
<ul><li><a href="index.html"><strong>üè† Project Overview</strong></a></li><li><a href="cache.html">cache</a></li><li><a href="chunk_utils.html">chunk_utils</a></li><li><a href="docgenerator.html">docgenerator</a></li><li><a href="explaincode.html">explaincode</a></li><li><a href="gui_wrapper.html">gui_wrapper</a></li><li><a href="html_writer.html">html_writer</a></li><li><a href="llm_client.html">llm_client</a></li><li><a href="manual_utils.html">manual_utils</a></li><li><a href="parser_cpp.html">parser_cpp</a></li><li><a href="parser_java.html">parser_java</a></li><li><a href="parser_matlab.html">parser_matlab</a></li><li><a href="parser_python.html">parser_python</a></li><li><a href="retrofit_sidebar.html">retrofit_sidebar</a></li><li><a href="reviewer.html">reviewer</a></li><li><a href="sanitize_docs.html">sanitize_docs</a></li><li><a href="scanner.html">scanner</a></li><li><a href="setup.html">setup</a></li><li><a href="summarize_utils.html">summarize_utils</a></li><li><details><summary>tests</summary><ul><li><a href="test_cache.html">test_cache</a></li><li><a href="test_chunk_utils.html">test_chunk_utils</a></li><li><a href="test_docgenerator.html">test_docgenerator</a></li><li><a href="test_docgenerator_subclasses.html">test_docgenerator_subclasses</a></li><li><a href="test_explaincode.html">test_explaincode</a></li><li><a href="test_html_writer.html">test_html_writer</a></li><li><a href="test_integration.html">test_integration</a></li><li><a href="test_llm_client.html">test_llm_client</a></li><li><a href="test_manual_utils.html">test_manual_utils</a></li><li><a href="test_parser_cpp.html">test_parser_cpp</a></li><li><a href="test_parser_java.html">test_parser_java</a></li><li><a href="test_parser_matlab.html">test_parser_matlab</a></li><li><a href="test_parser_python.html">test_parser_python</a></li><li><a href="test_resume_progress.html">test_resume_progress</a></li><li><a href="test_retrofit_sidebar.html">test_retrofit_sidebar</a></li><li><a href="test_reviewer.html">test_reviewer</a></li><li><a href="test_sanitize_docs.html">test_sanitize_docs</a></li><li><a href="test_scanner.html">test_scanner</a></li></ul></details></li></ul>
</div>
<main class="content" role="main">
        <div class="content-inner">
<h1>test_llm_client</h1>
<p>Module defines tests for an LLM client that interacts with a remote API to summarize code. Tests cover successful and failed ping operations, retry behavior during summarization, error handling for HTTP errors, and filtering of summary text. It verifies correct prompt template usage based on entity type and ensures proper sanitization of output. The module uses mocking to isolate the client logic from external dependencies.</p>
<h2>Functions</h2>
<h3 id="test_ping_success">test_ping_success() -&gt; None</h3>
<p>The function `test_ping_success` tests the `ping` method of the `LLMClient` class to verify successful connectivity. It creates a mocked HTTP client configured with a fake URL, sets up a mock response object that simulates a successful HTTP request, and patches the `requests.get` function to return this mock response. The test asserts that the `ping` method returns `True`, confirms that `requests.get` was called exactly once with the correct URL and a 2-second timeout, and verifies that `raise_for_status` was invoked on the mock response. This ensures the client correctly handles successful HTTP responses during connectivity checks.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_ping_success</span>() <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    client <span style="color: #666666">=</span> LLMClient(<span style="color: #BA2121">"http://fake"</span>)
    mock_response <span style="color: #666666">=</span> Mock()
    mock_response<span style="color: #666666">.</span>raise_for_status <span style="color: #666666">=</span> Mock()
    <span style="color: #008000; font-weight: bold">with</span> patch(<span style="color: #BA2121">"requests.get"</span>, return_value<span style="color: #666666">=</span>mock_response) <span style="color: #008000; font-weight: bold">as</span> get:
        <span style="color: #008000; font-weight: bold">assert</span> client<span style="color: #666666">.</span>ping() <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #008000; font-weight: bold">True</span>
        get<span style="color: #666666">.</span>assert_called_once_with(<span style="color: #BA2121">"http://fake"</span>, timeout<span style="color: #666666">=2.0</span>)
        mock_response<span style="color: #666666">.</span>raise_for_status<span style="color: #666666">.</span>assert_called_once()
</code></pre>
<h3 id="test_ping_failure">test_ping_failure() -&gt; None</h3>
<p>The function `test_ping_failure` tests the behavior of the `ping` method in the `LLMClient` class when a connection fails. It creates an `LLMClient` instance with a fake URL, patches the `requests.get` function to raise a `RequestException`, and asserts that calling `client.ping()` raises a `ConnectionError`.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_ping_failure</span>() <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    client <span style="color: #666666">=</span> LLMClient(<span style="color: #BA2121">"http://fake"</span>)
    <span style="color: #008000; font-weight: bold">with</span> patch(<span style="color: #BA2121">"requests.get"</span>, side_effect<span style="color: #666666">=</span>requests<span style="color: #666666">.</span>exceptions<span style="color: #666666">.</span>RequestException(<span style="color: #BA2121">"fail"</span>)):
        <span style="color: #008000; font-weight: bold">with</span> pytest<span style="color: #666666">.</span>raises(<span style="color: #CB3F38; font-weight: bold">ConnectionError</span>):
            client<span style="color: #666666">.</span>ping()
</code></pre>
<h3 id="test_summarize_retries_and_returns_summary">test_summarize_retries_and_returns_summary() -&gt; None</h3>
<p>The function `test_summarize_retries_and_returns_summary` tests the retry mechanism and response handling of the `summarize` method in the `LLMClient` class. It creates a mock HTTP client that simulates a failed request followed by a successful one. The test verifies that the client correctly retries the request, extracts the summary from the response, and ensures the prompt is properly formatted. The test checks that the method returns the expected summary text, that the request was made twice due to the retry, and that a sleep delay of 1 second occurs between attempts. It also confirms that the prompt sent to the LLM matches the expected template for the module summarization task.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_summarize_retries_and_returns_summary</span>() <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    client <span style="color: #666666">=</span> LLMClient(<span style="color: #BA2121">"http://fake"</span>)
    mock_response <span style="color: #666666">=</span> Mock()
    mock_response<span style="color: #666666">.</span>raise_for_status <span style="color: #666666">=</span> Mock()
    mock_response<span style="color: #666666">.</span>json<span style="color: #666666">.</span>return_value <span style="color: #666666">=</span> {
        <span style="color: #BA2121">"choices"</span>: [
            {<span style="color: #BA2121">"message"</span>: {<span style="color: #BA2121">"content"</span>: <span style="color: #BA2121">"You can run this.</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">Defines a class."</span>}}
        ]
    }
    <span style="color: #008000; font-weight: bold">with</span> patch(<span style="color: #BA2121">"llm_client.requests.post"</span>) <span style="color: #008000; font-weight: bold">as</span> post, patch(<span style="color: #BA2121">"llm_client.time.sleep"</span>) <span style="color: #008000; font-weight: bold">as</span> sleep:
        post<span style="color: #666666">.</span>side_effect <span style="color: #666666">=</span> [requests<span style="color: #666666">.</span>exceptions<span style="color: #666666">.</span>RequestException(<span style="color: #BA2121">"boom"</span>), mock_response]
        result <span style="color: #666666">=</span> client<span style="color: #666666">.</span>summarize(<span style="color: #BA2121">"text"</span>, <span style="color: #BA2121">"module"</span>)
        <span style="color: #008000; font-weight: bold">assert</span> result <span style="color: #666666">==</span> <span style="color: #BA2121">"Defines a class."</span>
        <span style="color: #008000; font-weight: bold">assert</span> post<span style="color: #666666">.</span>call_count <span style="color: #666666">==</span> <span style="color: #666666">2</span>
        sleep<span style="color: #666666">.</span>assert_called_once_with(<span style="color: #666666">1</span>)
        sent_prompt <span style="color: #666666">=</span> post<span style="color: #666666">.</span>call_args_list[<span style="color: #666666">1</span>][<span style="color: #666666">1</span>][<span style="color: #BA2121">"json"</span>][<span style="color: #BA2121">"messages"</span>][<span style="color: #666666">1</span>][<span style="color: #BA2121">"content"</span>]
        <span style="color: #008000; font-weight: bold">assert</span> sent_prompt <span style="color: #666666">==</span> PROMPT_TEMPLATES[<span style="color: #BA2121">"module"</span>]<span style="color: #666666">.</span>format(text<span style="color: #666666">=</span><span style="color: #BA2121">"text"</span>)
</code></pre>
<h3 id="test_summarize_raises_runtime_error_with_message">test_summarize_raises_runtime_error_with_message() -&gt; None</h3>
<p>The function `test_summarize_raises_runtime_error_with_message` tests the behavior of the `summarize` method in the `LLMClient` class when an HTTP error occurs during a request. It creates a mock HTTP response that simulates an error condition, including a non-success status code and a text message indicating "server exploded". The test patches the `requests.post` call to return this mock response and also patches `time.sleep` to avoid delays during the test. It then asserts that calling `client.summarize` with dummy arguments raises a `RuntimeError` with the expected error message "server exploded".</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_summarize_raises_runtime_error_with_message</span>() <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    client <span style="color: #666666">=</span> LLMClient(<span style="color: #BA2121">"http://fake"</span>)
    mock_response <span style="color: #666666">=</span> Mock()
    mock_response<span style="color: #666666">.</span>raise_for_status<span style="color: #666666">.</span>side_effect <span style="color: #666666">=</span> requests<span style="color: #666666">.</span>exceptions<span style="color: #666666">.</span>HTTPError(response<span style="color: #666666">=</span>mock_response)
    mock_response<span style="color: #666666">.</span>json<span style="color: #666666">.</span>side_effect <span style="color: #666666">=</span> <span style="color: #CB3F38; font-weight: bold">ValueError</span>()
    mock_response<span style="color: #666666">.</span>text <span style="color: #666666">=</span> <span style="color: #BA2121">"server exploded"</span>
    <span style="color: #008000; font-weight: bold">with</span> patch(<span style="color: #BA2121">"llm_client.requests.post"</span>, return_value<span style="color: #666666">=</span>mock_response), patch(<span style="color: #BA2121">"llm_client.time.sleep"</span>):
        <span style="color: #008000; font-weight: bold">with</span> pytest<span style="color: #666666">.</span>raises(<span style="color: #CB3F38; font-weight: bold">RuntimeError</span>, match<span style="color: #666666">=</span><span style="color: #BA2121">"server exploded"</span>):
            client<span style="color: #666666">.</span>summarize(<span style="color: #BA2121">"text"</span>, <span style="color: #BA2121">"module"</span>)
</code></pre>
<h3 id="test_summarize_does_not_stream_on_http_error">test_summarize_does_not_stream_on_http_error() -&gt; None</h3>
<p>The function `test_summarize_does_not_stream_on_http_error` tests that the `summarize` method of the `LLMClient` class does not attempt to stream a response when an HTTP error occurs. It creates a mock `LLMClient` instance with a fake URL, configures a mock HTTP response to raise an `HTTPError` and return a text body, and patches the `requests.post` call to return this mock response. The test verifies that calling `client.summarize` raises a `RuntimeError` with the expected error message and ensures that `iter_content` is not called on the mock response, confirming no streaming occurs during HTTP failures.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_summarize_does_not_stream_on_http_error</span>() <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
<span style="color: #bbbbbb">    </span><span style="color: #BA2121; font-style: italic">"""Streaming should not be attempted when the request fails."""</span>
    client <span style="color: #666666">=</span> LLMClient(<span style="color: #BA2121">"http://fake"</span>)
    mock_response <span style="color: #666666">=</span> Mock()
    mock_response<span style="color: #666666">.</span>raise_for_status<span style="color: #666666">.</span>side_effect <span style="color: #666666">=</span> requests<span style="color: #666666">.</span>exceptions<span style="color: #666666">.</span>HTTPError(
        response<span style="color: #666666">=</span>mock_response
    )
    mock_response<span style="color: #666666">.</span>json<span style="color: #666666">.</span>side_effect <span style="color: #666666">=</span> <span style="color: #CB3F38; font-weight: bold">ValueError</span>()
    mock_response<span style="color: #666666">.</span>text <span style="color: #666666">=</span> <span style="color: #BA2121">"boom"</span>
    mock_response<span style="color: #666666">.</span>iter_content <span style="color: #666666">=</span> Mock()

    <span style="color: #008000; font-weight: bold">with</span> patch(<span style="color: #BA2121">"llm_client.requests.post"</span>, return_value<span style="color: #666666">=</span>mock_response), patch(
        <span style="color: #BA2121">"llm_client.time.sleep"</span>
    ):
        <span style="color: #008000; font-weight: bold">with</span> pytest<span style="color: #666666">.</span>raises(<span style="color: #CB3F38; font-weight: bold">RuntimeError</span>, match<span style="color: #666666">=</span><span style="color: #BA2121">"boom"</span>):
            client<span style="color: #666666">.</span>summarize(<span style="color: #BA2121">"text"</span>, <span style="color: #BA2121">"module"</span>)

    mock_response<span style="color: #666666">.</span>iter_content<span style="color: #666666">.</span>assert_not_called()
</code></pre>
<h3 id="test_sanitize_summary_filters_phrases">test_sanitize_summary_filters_phrases() -&gt; None</h3>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_sanitize_summary_filters_phrases</span>() <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    text <span style="color: #666666">=</span> (
        <span style="color: #BA2121">"You can run this.</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">"</span>
        <span style="color: #BA2121">"Note that it is simple.</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">"</span>
        <span style="color: #BA2121">"Summarize the following function.</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">"</span>
        <span style="color: #BA2121">"You are a documentation engine.</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">"</span>
        <span style="color: #BA2121">"Defines a class.</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">"</span>
        <span style="color: #BA2121">"This summary does not include disclaimers.</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">"</span>
        <span style="color: #BA2121">"This script does nothing.</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">"</span>
        <span style="color: #BA2121">"It prints output."</span>
    )
    <span style="color: #008000; font-weight: bold">assert</span> sanitize_summary(text) <span style="color: #666666">==</span> <span style="color: #BA2121">"Defines a class.</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">It prints output."</span>
</code></pre>
<h3 id="test_sanitize_summary_removes_fim_tokens">test_sanitize_summary_removes_fim_tokens() -&gt; None</h3>
<p>The function `test_sanitize_summary_removes_fim_tokens` tests that the `sanitize_summary` function removes FIM (Fix, Insert, Modify) reserved tokens from input text to prevent tokenizer errors. It asserts that when given the input string "Defines „Äàfim_prefix„Äâa class.", the output is "Defines a class.".</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_sanitize_summary_removes_fim_tokens</span>() <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
<span style="color: #bbbbbb">    </span><span style="color: #BA2121; font-style: italic">"""FIM reserved tokens should be stripped to avoid tokenizer errors."""</span>
    text <span style="color: #666666">=</span> <span style="color: #BA2121">"Defines &lt;|fim_middle|&gt;a class."</span>
    <span style="color: #008000; font-weight: bold">assert</span> sanitize_summary(text) <span style="color: #666666">==</span> <span style="color: #BA2121">"Defines a class."</span>
</code></pre>
<h3 id="test_sanitize_summary_filters_ai_language_model">test_sanitize_summary_filters_ai_language_model() -&gt; None</h3>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_sanitize_summary_filters_ai_language_model</span>() <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    text <span style="color: #666666">=</span> <span style="color: #BA2121">"As an AI language model, I cannot help.</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">It prints output."</span>
    <span style="color: #008000; font-weight: bold">assert</span> sanitize_summary(text) <span style="color: #666666">==</span> <span style="color: #BA2121">"It prints output."</span>
</code></pre>
<h3 id="test_sanitize_summary_removes_prompt_lines">test_sanitize_summary_removes_prompt_lines() -&gt; None</h3>
<p>The function `test_sanitize_summary_removes_prompt_lines` tests the `sanitize_summary` function to ensure it removes prompt-related lines from input text. The test provides a string containing multiple lines, including instructions and prompts, and asserts that the output of `sanitize_summary` contains only the line "Defines a class." This demonstrates that the function correctly filters out lines beginning with "- Do not" or similar prompt directives, retaining only the core content.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_sanitize_summary_removes_prompt_lines</span>() <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    text <span style="color: #666666">=</span> (
        <span style="color: #BA2121">"Summarize the module below.</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">"</span>
        <span style="color: #BA2121">"- Do not refer to yourself, the summary, or the response.</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">"</span>
        <span style="color: #BA2121">"Defines a class.</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">"</span>
        <span style="color: #BA2121">"- Do not include instructions, usage advice, or disclaimers."</span>
    )
    <span style="color: #008000; font-weight: bold">assert</span> sanitize_summary(text) <span style="color: #666666">==</span> <span style="color: #BA2121">"Defines a class."</span>
</code></pre>
<h3 id="test_sanitize_summary_filters_altered_prompt_line">test_sanitize_summary_filters_altered_prompt_line() -&gt; None</h3>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_sanitize_summary_filters_altered_prompt_line</span>() <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    text <span style="color: #666666">=</span> (
        <span style="color: #BA2121">"Code: example snippet</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">"</span>
        <span style="color: #BA2121">"Defines a class."</span>
    )
    <span style="color: #008000; font-weight: bold">assert</span> sanitize_summary(text) <span style="color: #666666">==</span> <span style="color: #BA2121">"Defines a class."</span>
</code></pre>
<h3 id="test_sanitize_summary_filters_truncated_prompt_line">test_sanitize_summary_filters_truncated_prompt_line() -&gt; None</h3>
<p>The function `test_sanitize_summary_filters_truncated_prompt_line` tests the `sanitize_summary` function to ensure it removes a specific prompt line from the input text. The test provides a string containing two lines: a prompt line "Do not say what is or isn't included in the code" and a content line "Defines a class." The assertion verifies that `sanitize_summary` returns only the content line, filtering out the prompt.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_sanitize_summary_filters_truncated_prompt_line</span>() <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    text <span style="color: #666666">=</span> (
        <span style="color: #BA2121">"Do not say what is or isn't included in the code</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">"</span>
        <span style="color: #BA2121">"Defines a class."</span>
    )
    <span style="color: #008000; font-weight: bold">assert</span> sanitize_summary(text) <span style="color: #666666">==</span> <span style="color: #BA2121">"Defines a class."</span>
</code></pre>
<h3 id="test_prompt_varies_by_type">test_prompt_varies_by_type() -&gt; None</h3>
<p>The function `test_prompt_varies_by_type` tests that the prompt template used by the `LLMClient` varies depending on the type of code element being summarized. It creates a mock LLM client and verifies that when summarizing with types "class" and "function", the respective prompts are correctly formatted using `PROMPT_TEMPLATES` and that the class and function prompts are distinct. The test patches the HTTP post request to simulate API responses and checks the content of the second message in the JSON payload sent to the LLM, ensuring it matches the expected template for each element type.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_prompt_varies_by_type</span>() <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    client <span style="color: #666666">=</span> LLMClient(<span style="color: #BA2121">"http://fake"</span>)
    mock_response <span style="color: #666666">=</span> Mock()
    mock_response<span style="color: #666666">.</span>raise_for_status <span style="color: #666666">=</span> Mock()
    mock_response<span style="color: #666666">.</span>json<span style="color: #666666">.</span>return_value <span style="color: #666666">=</span> {<span style="color: #BA2121">"choices"</span>: [{<span style="color: #BA2121">"message"</span>: {<span style="color: #BA2121">"content"</span>: <span style="color: #BA2121">"x"</span>}}]}

    <span style="color: #008000; font-weight: bold">with</span> patch(<span style="color: #BA2121">"llm_client.requests.post"</span>, return_value<span style="color: #666666">=</span>mock_response) <span style="color: #008000; font-weight: bold">as</span> post:
        client<span style="color: #666666">.</span>summarize(<span style="color: #BA2121">"foo"</span>, <span style="color: #BA2121">"class"</span>)
        class_prompt <span style="color: #666666">=</span> post<span style="color: #666666">.</span>call_args[<span style="color: #666666">1</span>][<span style="color: #BA2121">"json"</span>][<span style="color: #BA2121">"messages"</span>][<span style="color: #666666">1</span>][<span style="color: #BA2121">"content"</span>]

    <span style="color: #008000; font-weight: bold">with</span> patch(<span style="color: #BA2121">"llm_client.requests.post"</span>, return_value<span style="color: #666666">=</span>mock_response) <span style="color: #008000; font-weight: bold">as</span> post:
        client<span style="color: #666666">.</span>summarize(<span style="color: #BA2121">"foo"</span>, <span style="color: #BA2121">"function"</span>)
        func_prompt <span style="color: #666666">=</span> post<span style="color: #666666">.</span>call_args[<span style="color: #666666">1</span>][<span style="color: #BA2121">"json"</span>][<span style="color: #BA2121">"messages"</span>][<span style="color: #666666">1</span>][<span style="color: #BA2121">"content"</span>]

    <span style="color: #008000; font-weight: bold">assert</span> class_prompt <span style="color: #666666">==</span> PROMPT_TEMPLATES[<span style="color: #BA2121">"class"</span>]<span style="color: #666666">.</span>format(text<span style="color: #666666">=</span><span style="color: #BA2121">"foo"</span>)
    <span style="color: #008000; font-weight: bold">assert</span> func_prompt <span style="color: #666666">==</span> PROMPT_TEMPLATES[<span style="color: #BA2121">"function"</span>]<span style="color: #666666">.</span>format(text<span style="color: #666666">=</span><span style="color: #BA2121">"foo"</span>)
    <span style="color: #008000; font-weight: bold">assert</span> class_prompt <span style="color: #666666">!=</span> func_prompt
</code></pre>
<h3 id="test_readme_prompt_template_used">test_readme_prompt_template_used() -&gt; None</h3>
<p>The function `test_readme_prompt_template_used` tests that the correct prompt template is applied when summarizing text for a README file using an `LLMClient`. It creates a mock LLM client, simulates an API response, and verifies that the second message in the JSON payload sent to the client uses the `readme` prompt template formatted with the input text. The test ensures proper integration of the prompt template with the summarization process.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_readme_prompt_template_used</span>() <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    client <span style="color: #666666">=</span> LLMClient(<span style="color: #BA2121">"http://fake"</span>)
    mock_response <span style="color: #666666">=</span> Mock()
    mock_response<span style="color: #666666">.</span>raise_for_status <span style="color: #666666">=</span> Mock()
    mock_response<span style="color: #666666">.</span>json<span style="color: #666666">.</span>return_value <span style="color: #666666">=</span> {<span style="color: #BA2121">"choices"</span>: [{<span style="color: #BA2121">"message"</span>: {<span style="color: #BA2121">"content"</span>: <span style="color: #BA2121">"x"</span>}}]}

    <span style="color: #008000; font-weight: bold">with</span> patch(<span style="color: #BA2121">"llm_client.requests.post"</span>, return_value<span style="color: #666666">=</span>mock_response) <span style="color: #008000; font-weight: bold">as</span> post:
        client<span style="color: #666666">.</span>summarize(<span style="color: #BA2121">"foo"</span>, <span style="color: #BA2121">"readme"</span>)
        readme_prompt <span style="color: #666666">=</span> post<span style="color: #666666">.</span>call_args[<span style="color: #666666">1</span>][<span style="color: #BA2121">"json"</span>][<span style="color: #BA2121">"messages"</span>][<span style="color: #666666">1</span>][<span style="color: #BA2121">"content"</span>]

    <span style="color: #008000; font-weight: bold">assert</span> readme_prompt <span style="color: #666666">==</span> PROMPT_TEMPLATES[<span style="color: #BA2121">"readme"</span>]<span style="color: #666666">.</span>format(text<span style="color: #666666">=</span><span style="color: #BA2121">"foo"</span>)
</code></pre>
</div>
    </main>
<script src="static/toggle.js"></script>
</body>
</html>
