<!-- Generated by DocGen-LM -->
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/><meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>retrofit_sidebar</title>
<link href="static/style.css" rel="stylesheet"/>
</head>
<body><a class="skip-link" href="#main-content">Skip to main content</a><header class="topbar"><button aria-label="Toggle navigation menu" id="sidebar-toggle">Menu</button><span class="topbar-title">retrofit_sidebar</span></header>
<nav aria-label="Documentation navigation" class="sidebar">
<h2>Navigation</h2>
<ul><li><a href="index.html"><strong>üè† Project Overview</strong></a></li><li><a href="cache.html">cache</a></li><li><a href="chunk_utils.html">chunk_utils</a></li><li><a href="docgenerator.html">docgenerator</a></li><li><a href="explaincode.html">explaincode</a></li><li><a href="gui_wrapper.html">gui_wrapper</a></li><li><a href="html_writer.html">html_writer</a></li><li><a href="llm_client.html">llm_client</a></li><li><a href="manual_utils.html">manual_utils</a></li><li><a href="parser_cpp.html">parser_cpp</a></li><li><a href="parser_java.html">parser_java</a></li><li><a href="parser_matlab.html">parser_matlab</a></li><li><a href="parser_python.html">parser_python</a></li><li><a href="retrofit_sidebar.html">retrofit_sidebar</a></li><li><a href="reviewer.html">reviewer</a></li><li><a href="sanitize_docs.html">sanitize_docs</a></li><li><a href="scanner.html">scanner</a></li><li><a href="setup.html">setup</a></li><li><a href="summarize_utils.html">summarize_utils</a></li><li><details><summary>tests</summary><ul><li><a href="test_cache.html">test_cache</a></li><li><a href="test_chunk_utils.html">test_chunk_utils</a></li><li><a href="test_docgenerator.html">test_docgenerator</a></li><li><a href="test_docgenerator_subclasses.html">test_docgenerator_subclasses</a></li><li><a href="test_explaincode.html">test_explaincode</a></li><li><a href="test_html_writer.html">test_html_writer</a></li><li><a href="test_integration.html">test_integration</a></li><li><a href="test_llm_client.html">test_llm_client</a></li><li><a href="test_manual_utils.html">test_manual_utils</a></li><li><a href="test_parser_cpp.html">test_parser_cpp</a></li><li><a href="test_parser_java.html">test_parser_java</a></li><li><a href="test_parser_matlab.html">test_parser_matlab</a></li><li><a href="test_parser_python.html">test_parser_python</a></li><li><a href="test_resume_progress.html">test_resume_progress</a></li><li><a href="test_retrofit_sidebar.html">test_retrofit_sidebar</a></li><li><a href="test_reviewer.html">test_reviewer</a></li><li><a href="test_sanitize_docs.html">test_sanitize_docs</a></li><li><a href="test_scanner.html">test_scanner</a></li></ul></details></li></ul>
</nav>
<main class="content" id="main-content" role="main">
<h1>retrofit_sidebar</h1>
<p>The module implements a tool to replace documentation sidebars with hierarchical lists of modules. It scans a source directory for files, constructs a tree structure from their paths, and generates HTML unordered lists to populate sidebar divs in documentation files. The script uses BeautifulSoup for HTML manipulation and supports command-line arguments for specifying the source and documentation directories. The process involves resolving file paths relative to a base directory, building a nested dictionary representation of the module structure, and converting this structure into HTML list elements with appropriate links to module documentation pages.</p>
<h2>Functions</h2>
<h3 id="_paths_to_tree">_paths_to_tree(paths: list[str]) -&gt; Dict[str, Any]</h3>
<p>The function `_paths_to_tree` converts a list of file paths into a nested dictionary representing a directory tree structure. Each path is split into its constituent parts, and the function iteratively builds the tree by creating nested dictionaries for each directory level. The final component of each path is added as a key with a value of `None`. The resulting dictionary mirrors the hierarchical organization of the input file paths.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">_paths_to_tree</span>(paths: <span style="color: #008000">list</span>[<span style="color: #008000">str</span>]) <span style="color: #666666">-&gt;</span> Dict[<span style="color: #008000">str</span>, Any]:
<span style="color: #bbbbbb">    </span><span style="color: #BA2121; font-style: italic">"""Convert a list of file paths into a nested dictionary tree."""</span>
    tree: Dict[<span style="color: #008000">str</span>, Any] <span style="color: #666666">=</span> {}
    <span style="color: #008000; font-weight: bold">for</span> path <span style="color: #AA22FF; font-weight: bold">in</span> paths:
        parts <span style="color: #666666">=</span> Path(path)<span style="color: #666666">.</span>parts
        node <span style="color: #666666">=</span> tree
        <span style="color: #008000; font-weight: bold">for</span> part <span style="color: #AA22FF; font-weight: bold">in</span> parts[:<span style="color: #666666">-1</span>]:
            node <span style="color: #666666">=</span> node<span style="color: #666666">.</span>setdefault(part, {})
        node<span style="color: #666666">.</span>setdefault(parts[<span style="color: #666666">-1</span>], <span style="color: #008000; font-weight: bold">None</span>)
    <span style="color: #008000; font-weight: bold">return</span> tree
</code></pre>
<h3 id="_tree_to_ul">_tree_to_ul(tree: Dict[str, Any], soup: BeautifulSoup, base: Path | str=Path()) -&gt; Any</h3>
<p>The function `_tree_to_ul` recursively constructs HTML `&lt;ul&gt;` elements from a nested dictionary `tree`, using BeautifulSoup to generate the markup. It takes a dictionary representing a hierarchical structure, a BeautifulSoup object for creating tags, and an optional base path to compute relative links. For each entry in the sorted keys of the dictionary, it creates a list item (`&lt;li&gt;`) containing either a nested `&lt;ul&gt;` for sub-dictionaries or an anchor tag (`&lt;a&gt;`) linking to an HTML file derived from the path. The resulting structure reflects the hierarchy of the input tree in HTML format.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">_tree_to_ul</span>(
    tree: Dict[<span style="color: #008000">str</span>, Any], soup: BeautifulSoup, base: Path <span style="color: #666666">|</span> <span style="color: #008000">str</span> <span style="color: #666666">=</span> Path()
) <span style="color: #666666">-&gt;</span> Any:
<span style="color: #bbbbbb">    </span><span style="color: #BA2121; font-style: italic">"""Recursively build ``&lt;ul&gt;`` elements from *tree*.</span>

<span style="color: #BA2121; font-style: italic">    ``base`` tracks the current path so that file entries can be linked to their</span>
<span style="color: #BA2121; font-style: italic">    corresponding HTML documentation using a relative path.</span>
<span style="color: #BA2121; font-style: italic">    """</span>

    base <span style="color: #666666">=</span> Path(base)
    ul <span style="color: #666666">=</span> soup<span style="color: #666666">.</span>new_tag(<span style="color: #BA2121">"ul"</span>)
    <span style="color: #008000; font-weight: bold">for</span> name <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">sorted</span>(tree):
        li <span style="color: #666666">=</span> soup<span style="color: #666666">.</span>new_tag(<span style="color: #BA2121">"li"</span>)
        child <span style="color: #666666">=</span> tree[name]
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">isinstance</span>(child, <span style="color: #008000">dict</span>) <span style="color: #AA22FF; font-weight: bold">and</span> child:
            li<span style="color: #666666">.</span>string <span style="color: #666666">=</span> name
            li<span style="color: #666666">.</span>append(_tree_to_ul(child, soup, base <span style="color: #666666">/</span> name))
        <span style="color: #008000; font-weight: bold">else</span>:
            href <span style="color: #666666">=</span> (base <span style="color: #666666">/</span> name)<span style="color: #666666">.</span>with_suffix(<span style="color: #BA2121">".html"</span>)<span style="color: #666666">.</span>as_posix()
            a <span style="color: #666666">=</span> soup<span style="color: #666666">.</span>new_tag(<span style="color: #BA2121">"a"</span>, href<span style="color: #666666">=</span>href)
            a<span style="color: #666666">.</span>string <span style="color: #666666">=</span> name
            li<span style="color: #666666">.</span>append(a)
        ul<span style="color: #666666">.</span>append(li)
    <span style="color: #008000; font-weight: bold">return</span> ul
</code></pre>
<h3 id="retrofit_sidebar">retrofit_sidebar(source_root: str, docs_dir: str) -&gt; None</h3>
<p>The function `retrofit_sidebar` updates HTML documentation files by replacing existing sidebars with a hierarchical list of modules. It takes the root directory of a source code tree and the directory containing documentation files as inputs. The function scans the source directory to identify module paths, constructs a hierarchical tree from these paths, and then processes each HTML file in the documentation directory. For every HTML file, it locates the sidebar element, clears its contents, and populates it with a structured unordered list generated from the module tree. The updated HTML content is then written back to the respective files.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">retrofit_sidebar</span>(source_root: <span style="color: #008000">str</span>, docs_dir: <span style="color: #008000">str</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
<span style="color: #bbbbbb">    </span><span style="color: #BA2121; font-style: italic">"""Replace documentation sidebars with a hierarchical module list."""</span>
    base <span style="color: #666666">=</span> Path(source_root)<span style="color: #666666">.</span>resolve()
    modules <span style="color: #666666">=</span> scanner<span style="color: #666666">.</span>scan_directory(<span style="color: #008000">str</span>(base), ignore<span style="color: #666666">=</span>[])
    relative <span style="color: #666666">=</span> [<span style="color: #008000">str</span>(Path(p)<span style="color: #666666">.</span>resolve()<span style="color: #666666">.</span>relative_to(base)) <span style="color: #008000; font-weight: bold">for</span> p <span style="color: #AA22FF; font-weight: bold">in</span> modules]
    tree <span style="color: #666666">=</span> _paths_to_tree(relative)

    docs_path <span style="color: #666666">=</span> Path(docs_dir)
    <span style="color: #008000; font-weight: bold">for</span> html_file <span style="color: #AA22FF; font-weight: bold">in</span> docs_path<span style="color: #666666">.</span>glob(<span style="color: #BA2121">"*.html"</span>):
        html_soup <span style="color: #666666">=</span> BeautifulSoup(html_file<span style="color: #666666">.</span>read_text(encoding<span style="color: #666666">=</span><span style="color: #BA2121">"utf-8"</span>), <span style="color: #BA2121">"html.parser"</span>)
        sidebar <span style="color: #666666">=</span> html_soup<span style="color: #666666">.</span>find(<span style="color: #BA2121">"div"</span>, class_<span style="color: #666666">=</span><span style="color: #BA2121">"sidebar"</span>)
        <span style="color: #008000; font-weight: bold">if</span> sidebar <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #AA22FF; font-weight: bold">not</span> <span style="color: #008000; font-weight: bold">None</span>:
            sidebar<span style="color: #666666">.</span>clear()
            sidebar<span style="color: #666666">.</span>append(_tree_to_ul(tree, html_soup))
            html_file<span style="color: #666666">.</span>write_text(<span style="color: #008000">str</span>(html_soup), encoding<span style="color: #666666">=</span><span style="color: #BA2121">"utf-8"</span>)
</code></pre>
<h3 id="main">main() -&gt; int</h3>
<p>The `main` function serves as the entry point for a documentation tool that replaces a sidebar in a documentation directory with a hierarchical module list derived from a source code directory. It uses `argparse` to accept command-line arguments for specifying the source root directory and documentation directory, defaulting to the current directory and "Docs", respectively. The function validates that both directories exist and are directories. If validation fails, it prints an error message to stderr and returns an exit code of 1. On successful validation, it calls `retrofit_sidebar` with the paths of the source and documentation directories, then returns an exit code of 0.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">main</span>() <span style="color: #666666">-&gt;</span> <span style="color: #008000">int</span>:
    parser <span style="color: #666666">=</span> argparse<span style="color: #666666">.</span>ArgumentParser(
        description<span style="color: #666666">=</span><span style="color: #BA2121">"Replace docs sidebar with hierarchical module list."</span>,
    )
    parser<span style="color: #666666">.</span>add_argument(<span style="color: #BA2121">"--source"</span>, default<span style="color: #666666">=</span><span style="color: #BA2121">"."</span>, help<span style="color: #666666">=</span><span style="color: #BA2121">"Source root directory"</span>)
    parser<span style="color: #666666">.</span>add_argument(<span style="color: #BA2121">"--docs"</span>, default<span style="color: #666666">=</span><span style="color: #BA2121">"Docs"</span>, help<span style="color: #666666">=</span><span style="color: #BA2121">"Documentation directory"</span>)
    args <span style="color: #666666">=</span> parser<span style="color: #666666">.</span>parse_args()

    source_path <span style="color: #666666">=</span> Path(args<span style="color: #666666">.</span>source)
    docs_path <span style="color: #666666">=</span> Path(args<span style="color: #666666">.</span>docs)
    <span style="color: #008000; font-weight: bold">if</span> <span style="color: #AA22FF; font-weight: bold">not</span> source_path<span style="color: #666666">.</span>is_dir():
        <span style="color: #008000">print</span>(
            <span style="color: #BA2121">f"Error: source directory '</span><span style="color: #A45A77; font-weight: bold">{</span>source_path<span style="color: #A45A77; font-weight: bold">}</span><span style="color: #BA2121">' does not exist or is not a directory"</span>,
            file<span style="color: #666666">=</span>sys<span style="color: #666666">.</span>stderr,
        )
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #666666">1</span>
    <span style="color: #008000; font-weight: bold">if</span> <span style="color: #AA22FF; font-weight: bold">not</span> docs_path<span style="color: #666666">.</span>is_dir():
        <span style="color: #008000">print</span>(
            <span style="color: #BA2121">f"Error: docs directory '</span><span style="color: #A45A77; font-weight: bold">{</span>docs_path<span style="color: #A45A77; font-weight: bold">}</span><span style="color: #BA2121">' does not exist or is not a directory"</span>,
            file<span style="color: #666666">=</span>sys<span style="color: #666666">.</span>stderr,
        )
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #666666">1</span>

    retrofit_sidebar(<span style="color: #008000">str</span>(source_path), <span style="color: #008000">str</span>(docs_path))
    <span style="color: #008000; font-weight: bold">return</span> <span style="color: #666666">0</span>
</code></pre>
</main>
<footer aria-label="Page footer" class="page-footer"><p>Generated documentation</p></footer><script src="static/toggle.js"></script>
</body>
</html>
