<!-- Generated by DocGen-LM -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>retrofit_sidebar</title>
    <link rel="stylesheet" href="static/style.css">
</head>
<body>
    <button id="sidebar-toggle">Menu</button>
    <div class="sidebar">
        <h2>Navigation</h2>
        <ul><li><a href="index.html"><strong>üè† Project Overview</strong></a></li><li><a href="cache.html">cache</a></li><li><a href="chunk_utils.html">chunk_utils</a></li><li><a href="docgenerator.html">docgenerator</a></li><li><a href="explaincode.html">explaincode</a></li><li><a href="gui_wrapper.html">gui_wrapper</a></li><li><a href="html_writer.html">html_writer</a></li><li><a href="llm_client.html">llm_client</a></li><li><a href="manual_utils.html">manual_utils</a></li><li><a href="parser_cpp.html">parser_cpp</a></li><li><a href="parser_java.html">parser_java</a></li><li><a href="parser_matlab.html">parser_matlab</a></li><li><a href="parser_python.html">parser_python</a></li><li><a href="retrofit_sidebar.html">retrofit_sidebar</a></li><li><a href="reviewer.html">reviewer</a></li><li><a href="sanitize_docs.html">sanitize_docs</a></li><li><a href="scanner.html">scanner</a></li><li><a href="setup.html">setup</a></li><li><a href="summarize_utils.html">summarize_utils</a></li><li><details><summary>tests</summary><ul><li><a href="test_cache.html">test_cache</a></li><li><a href="test_chunk_utils.html">test_chunk_utils</a></li><li><a href="test_docgenerator.html">test_docgenerator</a></li><li><a href="test_docgenerator_subclasses.html">test_docgenerator_subclasses</a></li><li><a href="test_explaincode.html">test_explaincode</a></li><li><a href="test_html_writer.html">test_html_writer</a></li><li><a href="test_integration.html">test_integration</a></li><li><a href="test_llm_client.html">test_llm_client</a></li><li><a href="test_manual_utils.html">test_manual_utils</a></li><li><a href="test_parser_cpp.html">test_parser_cpp</a></li><li><a href="test_parser_java.html">test_parser_java</a></li><li><a href="test_parser_matlab.html">test_parser_matlab</a></li><li><a href="test_parser_python.html">test_parser_python</a></li><li><a href="test_resume_progress.html">test_resume_progress</a></li><li><a href="test_reviewer.html">test_reviewer</a></li><li><a href="test_sanitize_docs.html">test_sanitize_docs</a></li><li><a href="test_scanner.html">test_scanner</a></li></ul></details></li></ul>
    </div>
    <div class="content">
        <h1>retrofit_sidebar</h1>
        <p>This module defines a script to replace documentation sidebars with a hierarchical module list. It includes functions for converting file paths into a nested dictionary tree and recursively building unordered lists from this tree. The `retrofit_sidebar` function scans a source directory for Python modules, constructs a hierarchical structure, and updates HTML files in the documentation directory by replacing existing sidebars with the new hierarchical module list. The script is executed via the command line with optional arguments for specifying the source root directory and the documentation directory.</p>
<h2>Functions</h2>
<h3 id="_paths_to_tree">_paths_to_tree(paths: list[str]) -&gt; Dict[str, Any]</h3>
<p>Converts a list of file paths into a nested dictionary tree. Each path is split into parts, and the function builds a dictionary structure where each key represents a directory or file name, with nested dictionaries representing subdirectories. The final part of each path becomes a leaf node in the tree.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">_paths_to_tree</span>(paths: <span style="color: #008000">list</span>[<span style="color: #008000">str</span>]) <span style="color: #666666">-&gt;</span> Dict[<span style="color: #008000">str</span>, Any]:
<span style="color: #bbbbbb">    </span><span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Convert a list of file paths into a nested dictionary tree.&quot;&quot;&quot;</span>
    tree: Dict[<span style="color: #008000">str</span>, Any] <span style="color: #666666">=</span> {}
    <span style="color: #008000; font-weight: bold">for</span> path <span style="color: #AA22FF; font-weight: bold">in</span> paths:
        parts <span style="color: #666666">=</span> Path(path)<span style="color: #666666">.</span>parts
        node <span style="color: #666666">=</span> tree
        <span style="color: #008000; font-weight: bold">for</span> part <span style="color: #AA22FF; font-weight: bold">in</span> parts[:<span style="color: #666666">-1</span>]:
            node <span style="color: #666666">=</span> node<span style="color: #666666">.</span>setdefault(part, {})
        node<span style="color: #666666">.</span>setdefault(parts[<span style="color: #666666">-1</span>], <span style="color: #008000; font-weight: bold">None</span>)
    <span style="color: #008000; font-weight: bold">return</span> tree
</code></pre>
<h3 id="_tree_to_ul">_tree_to_ul(tree: Dict[str, Any], soup: BeautifulSoup) -&gt; Any</h3>
<p>This function recursively constructs an unordered list (`&lt;ul&gt;`) from a nested dictionary structure. It iterates through the keys of the dictionary, creating list items (`&lt;li&gt;`) for each key and appending them to the `&lt;ul&gt;`. If a value is another dictionary, it calls itself recursively to create nested lists. The resulting `&lt;ul&gt;` element is returned.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">_tree_to_ul</span>(tree: Dict[<span style="color: #008000">str</span>, Any], soup: BeautifulSoup) <span style="color: #666666">-&gt;</span> Any:
<span style="color: #bbbbbb">    </span><span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Recursively build ``&lt;ul&gt;`` elements from *tree*.&quot;&quot;&quot;</span>
    ul <span style="color: #666666">=</span> soup<span style="color: #666666">.</span>new_tag(<span style="color: #BA2121">&quot;ul&quot;</span>)
    <span style="color: #008000; font-weight: bold">for</span> name <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">sorted</span>(tree):
        li <span style="color: #666666">=</span> soup<span style="color: #666666">.</span>new_tag(<span style="color: #BA2121">&quot;li&quot;</span>)
        li<span style="color: #666666">.</span>string <span style="color: #666666">=</span> name
        child <span style="color: #666666">=</span> tree[name]
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">isinstance</span>(child, <span style="color: #008000">dict</span>) <span style="color: #AA22FF; font-weight: bold">and</span> child:
            li<span style="color: #666666">.</span>append(_tree_to_ul(child, soup))
        ul<span style="color: #666666">.</span>append(li)
    <span style="color: #008000; font-weight: bold">return</span> ul
</code></pre>
<h3 id="retrofit_sidebar">retrofit_sidebar(source_root: str, docs_dir: str) -&gt; None</h3>
<p>The function `retrofit_sidebar` takes two parameters: `source_root` and `docs_dir`. It scans the directory specified by `source_root` to find all Python files. These file paths are converted into a hierarchical tree structure using `_paths_to_tree`. The HTML markup for this tree is then generated using `_tree_to_ul`.

The function iterates over all `.html` files in the directory specified by `docs_dir`. For each HTML file, it finds the `&lt;div&gt;` element with the class &quot;sidebar&quot; and replaces its content with the newly generated sidebar markup. The modified HTML file is then saved back to disk.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">retrofit_sidebar</span>(source_root: <span style="color: #008000">str</span>, docs_dir: <span style="color: #008000">str</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
<span style="color: #bbbbbb">    </span><span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Replace documentation sidebars with a hierarchical module list.&quot;&quot;&quot;</span>
    base <span style="color: #666666">=</span> Path(source_root)<span style="color: #666666">.</span>resolve()
    modules <span style="color: #666666">=</span> scanner<span style="color: #666666">.</span>scan_directory(<span style="color: #008000">str</span>(base), ignore<span style="color: #666666">=</span>[])
    relative <span style="color: #666666">=</span> [<span style="color: #008000">str</span>(Path(p)<span style="color: #666666">.</span>resolve()<span style="color: #666666">.</span>relative_to(base)) <span style="color: #008000; font-weight: bold">for</span> p <span style="color: #AA22FF; font-weight: bold">in</span> modules]
    tree <span style="color: #666666">=</span> _paths_to_tree(relative)

    soup <span style="color: #666666">=</span> BeautifulSoup(<span style="color: #BA2121">&quot;&quot;</span>, <span style="color: #BA2121">&quot;html.parser&quot;</span>)
    sidebar_markup <span style="color: #666666">=</span> <span style="color: #008000">str</span>(_tree_to_ul(tree, soup))

    docs_path <span style="color: #666666">=</span> Path(docs_dir)
    <span style="color: #008000; font-weight: bold">for</span> html_file <span style="color: #AA22FF; font-weight: bold">in</span> docs_path<span style="color: #666666">.</span>glob(<span style="color: #BA2121">&quot;*.html&quot;</span>):
        html_soup <span style="color: #666666">=</span> BeautifulSoup(html_file<span style="color: #666666">.</span>read_text(encoding<span style="color: #666666">=</span><span style="color: #BA2121">&quot;utf-8&quot;</span>), <span style="color: #BA2121">&quot;html.parser&quot;</span>)
        sidebar <span style="color: #666666">=</span> html_soup<span style="color: #666666">.</span>find(<span style="color: #BA2121">&quot;div&quot;</span>, class_<span style="color: #666666">=</span><span style="color: #BA2121">&quot;sidebar&quot;</span>)
        <span style="color: #008000; font-weight: bold">if</span> sidebar <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #AA22FF; font-weight: bold">not</span> <span style="color: #008000; font-weight: bold">None</span>:
            sidebar<span style="color: #666666">.</span>replace_with(BeautifulSoup(sidebar_markup, <span style="color: #BA2121">&quot;html.parser&quot;</span>))
            html_file<span style="color: #666666">.</span>write_text(<span style="color: #008000">str</span>(html_soup), encoding<span style="color: #666666">=</span><span style="color: #BA2121">&quot;utf-8&quot;</span>)
</code></pre>
<h3 id="main">main() -&gt; None</h3>
<p>The `main` function sets up an argument parser to handle command-line arguments for specifying the source root directory and the documentation directory. It then calls the `retrofit_sidebar` function with these arguments to modify a sidebar with documentation information based on the hierarchical module list of the project.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">main</span>() <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    parser <span style="color: #666666">=</span> argparse<span style="color: #666666">.</span>ArgumentParser(
        description<span style="color: #666666">=</span><span style="color: #BA2121">&quot;Replace docs sidebar with hierarchical module list.&quot;</span>
    )
    parser<span style="color: #666666">.</span>add_argument(<span style="color: #BA2121">&quot;--source&quot;</span>, default<span style="color: #666666">=</span><span style="color: #BA2121">&quot;.&quot;</span>, help<span style="color: #666666">=</span><span style="color: #BA2121">&quot;Source root directory&quot;</span>)
    parser<span style="color: #666666">.</span>add_argument(<span style="color: #BA2121">&quot;--docs&quot;</span>, default<span style="color: #666666">=</span><span style="color: #BA2121">&quot;Docs&quot;</span>, help<span style="color: #666666">=</span><span style="color: #BA2121">&quot;Documentation directory&quot;</span>)
    args <span style="color: #666666">=</span> parser<span style="color: #666666">.</span>parse_args()
    retrofit_sidebar(args<span style="color: #666666">.</span>source, args<span style="color: #666666">.</span>docs)
</code></pre>
    </div>
    <script src="static/toggle.js"></script>
</body>
</html>
